

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DesignPatternsPHP 1.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/_static/css/theme.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="README.html#document-README" class="icon icon-home"> DesignPatternsPHP
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="README.html#document-Creational/README">1. 创建型设计模式</a><ul>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/AbstractFactory/README">1.1. 抽象工厂</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/Builder/README">1.2. 生成器模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/FactoryMethod/README">1.3. 工厂方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/Pool/README">1.4. 对象池</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/Prototype/README">1.5. 原型模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/SimpleFactory/README">1.6. 简单工厂</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/Singleton/README">1.7. 单例模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Creational/StaticFactory/README">1.8. 静态工厂</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="README.html#document-Structural/README">2. 结构型设计模式</a><ul>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Adapter/README">2.1. 适配器模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Bridge/README">2.2. 桥接模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Composite/README">2.3. 组合模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/DataMapper/README">2.4. 数据映射器</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Decorator/README">2.5. 装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/DependencyInjection/README">2.6. <cite>依赖注入</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Facade/README">2.7. 外观模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/FluentInterface/README">2.8. 连贯接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Flyweight/README">2.9. Flyweight</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Proxy/README">2.10. 代理模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Structural/Registry/README">2.11. 注册模式</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="README.html#document-Behavioral/README">3. Behavioral</a><ul>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/ChainOfResponsibilities/README">3.1. Chain Of Responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Command/README">3.2. Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Iterator/README">3.3. Iterator</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Mediator/README">3.4. Mediator</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Memento/README">3.5. Memento</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/NullObject/README">3.6. Null Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Observer/README">3.7. Observer</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Specification/README">3.8. Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/State/README">3.9. State</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Strategy/README">3.10. Strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/TemplateMethod/README">3.11. Template Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-Behavioral/Visitor/README">3.12. Visitor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="README.html#document-More/README">4. More</a><ul>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-More/ServiceLocator/README">4.1. Service Locator</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-More/Repository/README">4.2. Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html#document-More/EAV/README">4.3. Entity-Attribute-Value (EAV)</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="README.html#document-README">DesignPatternsPHP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="README.html#document-README">Docs</a> &raquo;</li>
        
      <li>DesignPatternsPHP 1.0 文档</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/domnikl/DesignPatternsPHP/blob/master/README.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="designpatternsphp">
<h1>PHP设计模式范例<a class="headerlink" href="#designpatternsphp" title="永久链接至标题">¶</a></h1>
<a class="reference external image-reference" href="https://github.com/domnikl/DesignPatternsPHP/actions"><img alt="Build Status" src="https://github.com/domnikl/DesignPatternsPHP/workflows/CI/badge.svg" /></a>
<a class="reference external image-reference" href="https://readthedocs.org/projects/designpatternsphp/?badge=latest"><img alt="Documentation Status" src="https://readthedocs.org/projects/designpatternsphp/badge/?version=latest" /></a>
<a class="reference external image-reference" href="https://paypal.me/DominikLiebler"><img alt="Donate" src="https://img.shields.io/badge/donate-paypal-blue.svg?style=flat-square" /></a>
<p>这里收集了一些知名的 <a href="#id1"><span class="problematic" id="id2">`设计模式`_</span></a> 以及它们对应的 PHP 实现的代码，每个模式都附有一个实际的例子。</p>
<p>我认为人们对于设计模式抱有的问题在于大家都了解它们却不知道该如何在实际中使用它们。</p>
<div class="section" id="patterns">
<h2>模式<a class="headerlink" href="#patterns" title="永久链接至标题">¶</a></h2>
<p>模式可以简单的被分为三大类。你可以点击每个模式页面下的标题来转到维基百科页面，来获取关于该模式更为详细的解释。</p>
<div class="toctree-wrapper compound">
<span id="document-Creational/README"></span><div class="section" id="creational">
<h3><a class="reference external" href="http://en.wikipedia.org/wiki/Creational_pattern">创建型设计模式</a><a class="headerlink" href="#creational" title="永久链接至标题">¶</a></h3>
<p>在软件工程中，创建型设计模式承担着对象创建的职责，尝试创建适合程序上下文的对象，对象创建设计模式的产生是由于软件工程设计的问题，具体说是向设计中增加复杂度，创建型设计模式解决了程序设计中对象创建的问题。</p>
<div class="toctree-wrapper compound">
<span id="document-Creational/AbstractFactory/README"></span><div class="section" id="abstract-factory">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">抽象工厂</a><a class="headerlink" href="#abstract-factory" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To create series of related or dependent objects without specifying
their concrete classes. Usually the created classes all implement the
same interface. The client of the abstract factory does not care about
how these objects are created, it just knows how they go together.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt AbstractFactory UML Diagram" class="align-center" src="_images/uml12.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/AbstractFactory">GitHub</a> 上查看代码</p>
<p>WriterFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">WriterFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createCsvWriter</span><span class="p">()</span><span class="o">:</span> <span class="nx">CsvWriter</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createJsonWriter</span><span class="p">()</span><span class="o">:</span> <span class="nx">JsonWriter</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>CsvWriter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">CsvWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$line</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>JsonWriter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">JsonWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$formatted</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UnixCsvWriter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UnixCsvWriter</span> <span class="k">implements</span> <span class="nx">CsvWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$line</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UnixJsonWriter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UnixJsonWriter</span> <span class="k">implements</span> <span class="nx">JsonWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$formatted</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$options</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$formatted</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$options</span> <span class="o">=</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UnixWriterFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UnixWriterFactory</span> <span class="k">implements</span> <span class="nx">WriterFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createCsvWriter</span><span class="p">()</span><span class="o">:</span> <span class="nx">CsvWriter</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">UnixCsvWriter</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">createJsonWriter</span><span class="p">()</span><span class="o">:</span> <span class="nx">JsonWriter</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">UnixJsonWriter</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>WinCsvWriter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WinCsvWriter</span> <span class="k">implements</span> <span class="nx">CsvWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$line</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>WinJsonWriter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WinJsonWriter</span> <span class="k">implements</span> <span class="nx">JsonWriter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$formatted</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>


        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>WinWriterFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WinWriterFactory</span> <span class="k">implements</span> <span class="nx">WriterFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createCsvWriter</span><span class="p">()</span><span class="o">:</span> <span class="nx">CsvWriter</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">WinCsvWriter</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">createJsonWriter</span><span class="p">()</span><span class="o">:</span> <span class="nx">JsonWriter</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">WinJsonWriter</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/AbstractFactoryTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\AbstractFactory\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\AbstractFactory\CsvWriter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\AbstractFactory\JsonWriter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\AbstractFactory\UnixWriterFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\AbstractFactory\WinWriterFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\AbstractFactory\WriterFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AbstractFactoryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provideFactory</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="k">new</span> <span class="nx">UnixWriterFactory</span><span class="p">()],</span>
            <span class="p">[</span><span class="k">new</span> <span class="nx">WinWriterFactory</span><span class="p">()]</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @dataProvider provideFactory</span>
<span class="sd">     *</span>
<span class="sd">     * @param WriterFactory $writerFactory</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCreateCsvWriterOnUnix</span><span class="p">(</span><span class="nx">WriterFactory</span> <span class="nv">$writerFactory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">JsonWriter</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$writerFactory</span><span class="o">-&gt;</span><span class="na">createJsonWriter</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">CsvWriter</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$writerFactory</span><span class="o">-&gt;</span><span class="na">createCsvWriter</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/Builder/README"></span><div class="section" id="builder">
<h4>生成器模式<a class="headerlink" href="#builder" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>生成器的目的是将复杂对象的创建过程（流程）进行抽象，生成器表现为接口的形式。</p>
<p>在特定的情况下，比如如果生成器对将要创建的对象有足够多的了解，那么代表生成器的接口(interface)可以是一个抽象类(也就是说可以有一定的具体实现，就像众所周知的适配器模式)。</p>
<p>如果对象有复杂的继承树，理论上创建对象的生成器也同样具有复杂的继承树。</p>
<p>提示：生成器通常具有流畅的接口，推荐阅读关于 PHPUnit 的mock生成器获取更好的理解。</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>PHPUnit: Mock 生成器</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Builder UML Diagram" class="align-center" src="_images/uml13.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/Builder">GitHub</a> 上找到这些代码</p>
<p>Director.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Vehicle</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Director is part of the builder pattern. It knows the interface of the builder</span>
<span class="sd"> * and builds a complex object with the help of the builder</span>
<span class="sd"> *</span>
<span class="sd"> * You can also inject many builders instead of one to build more complex objects</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Director</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">build</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">)</span><span class="o">:</span> <span class="nx">Vehicle</span>
    <span class="p">{</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">createVehicle</span><span class="p">();</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">addDoors</span><span class="p">();</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">addEngine</span><span class="p">();</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">addWheel</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">getVehicle</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Builder.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Vehicle</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Builder</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createVehicle</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addWheel</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addEngine</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addDoors</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getVehicle</span><span class="p">()</span><span class="o">:</span> <span class="nx">Vehicle</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>TruckBuilder.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Door</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Engine</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Wheel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Truck</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Vehicle</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TruckBuilder</span> <span class="k">implements</span> <span class="nx">Builder</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Truck</span> <span class="nv">$truck</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addDoors</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;rightDoor&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Door</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;leftDoor&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Door</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addEngine</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;truckEngine&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Engine</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addWheel</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheel1&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheel2&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheel3&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheel4&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheel5&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheel6&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">createVehicle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Truck</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getVehicle</span><span class="p">()</span><span class="o">:</span> <span class="nx">Vehicle</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">truck</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>CarBuilder.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Door</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Engine</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Wheel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Car</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Vehicle</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CarBuilder</span> <span class="k">implements</span> <span class="nx">Builder</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Car</span> <span class="nv">$car</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addDoors</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;rightDoor&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Door</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;leftDoor&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Door</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;trunkLid&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Door</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addEngine</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;engine&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Engine</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addWheel</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheelLF&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheelRF&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheelLR&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="o">-&gt;</span><span class="na">setPart</span><span class="p">(</span><span class="s1">&#39;wheelRR&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Wheel</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">createVehicle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Car</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getVehicle</span><span class="p">()</span><span class="o">:</span> <span class="nx">Vehicle</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">car</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Parts/Vehicle.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Parts</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Vehicle</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var object[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$data</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setPart</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">,</span> <span class="nx">object</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Parts/Truck.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Parts</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Truck</span> <span class="k">extends</span> <span class="nx">Vehicle</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Parts/Car.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Parts</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Car</span> <span class="k">extends</span> <span class="nx">Vehicle</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Parts/Engine.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Parts</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Engine</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Parts/Wheel.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Parts</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Wheel</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Parts/Door.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Parts</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Door</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/DirectorTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Builder\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Car</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Parts\Truck</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\TruckBuilder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\CarBuilder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Builder\Director</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DirectorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanBuildTruck</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$truckBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TruckBuilder</span><span class="p">();</span>
        <span class="nv">$newVehicle</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Director</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">build</span><span class="p">(</span><span class="nv">$truckBuilder</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Truck</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$newVehicle</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanBuildCar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$carBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CarBuilder</span><span class="p">();</span>
        <span class="nv">$newVehicle</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Director</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">build</span><span class="p">(</span><span class="nv">$carBuilder</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Car</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$newVehicle</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/FactoryMethod/README"></span><div class="section" id="factory-method">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Factory_method_pattern">工厂方法</a><a class="headerlink" href="#factory-method" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>The good point over the SimpleFactory is you can subclass it to
implement different ways to create objects.</p>
<p>For simple cases, this abstract class could be just an interface.</p>
<p>这个模式是一个 “真正” 的设计模式，因为它遵循了依赖反转原则（Dependency Inversion Principle） 众所周知这个 “D” 代表了真正的面向对象程序设计。</p>
<p>它意味着工厂方法类依赖于类的抽象，而不是具体将被创建的类，这是工厂方法模式与简单工厂模式和静态工厂模式最重要的区别</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt FactoryMethod UML Diagram" class="align-center" src="_images/uml14.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/FactoryMethod">GitHub</a> 上找到这些代码</p>
<p>Logger.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Logger</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$message</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StdoutLogger.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StdoutLogger</span> <span class="k">implements</span> <span class="nx">Logger</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>FileLogger.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileLogger</span> <span class="k">implements</span> <span class="nx">Logger</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$filePath</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$filePath</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filePath</span> <span class="o">=</span> <span class="nv">$filePath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filePath</span><span class="p">,</span> <span class="nv">$message</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">,</span> <span class="nx">FILE_APPEND</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>LoggerFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">LoggerFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createLogger</span><span class="p">()</span><span class="o">:</span> <span class="nx">Logger</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StdoutLoggerFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StdoutLoggerFactory</span> <span class="k">implements</span> <span class="nx">LoggerFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createLogger</span><span class="p">()</span><span class="o">:</span> <span class="nx">Logger</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">StdoutLogger</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>FileLoggerFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileLoggerFactory</span> <span class="k">implements</span> <span class="nx">LoggerFactory</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$filePath</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$filePath</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filePath</span> <span class="o">=</span> <span class="nv">$filePath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">createLogger</span><span class="p">()</span><span class="o">:</span> <span class="nx">Logger</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">FileLogger</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filePath</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/FactoryMethodTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\FactoryMethod\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\FactoryMethod\FileLogger</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\FactoryMethod\FileLoggerFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\FactoryMethod\StdoutLogger</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\FactoryMethod\StdoutLoggerFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FactoryMethodTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCreateStdoutLogging</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$loggerFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StdoutLoggerFactory</span><span class="p">();</span>
        <span class="nv">$logger</span> <span class="o">=</span> <span class="nv">$loggerFactory</span><span class="o">-&gt;</span><span class="na">createLogger</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">StdoutLogger</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCreateFileLogging</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$loggerFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileLoggerFactory</span><span class="p">(</span><span class="nb">sys_get_temp_dir</span><span class="p">());</span>
        <span class="nv">$logger</span> <span class="o">=</span> <span class="nv">$loggerFactory</span><span class="o">-&gt;</span><span class="na">createLogger</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">FileLogger</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/Pool/README"></span><div class="section" id="pool">
<h4>对象池<a class="headerlink" href="#pool" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p><strong>对象池设计模式</strong> 是创建型设计模式，它会对新创建的对象应用一系列的初始化操作，让对象保持立即可使用的状态 - 一个存放对象的 “池子” - 而不是对对象进行一次性的的使用(创建并使用，完成之后立即销毁)。对象池的使用者会对对象池发起请求，以期望获取一个对象，并使用获取到的对象进行一系列操作，当使用者对对象的使用完成之后，使用者会将由对象池的对象创建工厂创建的对象返回给对象池，而不是用完之后销毁获取到的对象。</p>
<p>对象池在某些情况下会带来重要的性能提升，比如耗费资源的对象初始化操作，实例化类的代价很高，但每次实例化的数量较少的情况下。对象池中将被创建的对象会在真正被使用时被提前创建，避免在使用时让使用者浪费对象创建所需的大量时间(比如在对象某些操作需要访问网络资源的情况下)从池子中取得对象的时间是可预测的，但新建一个实例所需的时间是不确定。</p>
<p>总之，对象池会为你节省宝贵的程序执行时间，比如像数据库连接，socket连接，大量耗费资源的代表数字资源的对象，像字体或者位图。不过，在特定情况下，简单的对象创建池(没有请求外部的资源，仅仅将自身保存在内存中)或许并不会提升效率和性能，这时候，就需要使用者酌情考虑了。</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Pool UML Diagram" class="align-center" src="_images/uml15.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/Pool">GitHub</a> 上找到这些代码</p>
<p>WorkerPool.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Pool</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Countable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WorkerPool</span> <span class="k">implements</span> <span class="nx">Countable</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var StringReverseWorker[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$occupiedWorkers</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @var StringReverseWorker[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$freeWorkers</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span><span class="o">:</span> <span class="nx">StringReverseWorker</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StringReverseWorker</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$worker</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">[</span><span class="nb">spl_object_hash</span><span class="p">(</span><span class="nv">$worker</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$worker</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$worker</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">dispose</span><span class="p">(</span><span class="nx">StringReverseWorker</span> <span class="nv">$worker</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="nb">spl_object_hash</span><span class="p">(</span><span class="nv">$worker</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$worker</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">occupiedWorkers</span><span class="p">)</span> <span class="o">+</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">freeWorkers</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StringReverseWorker.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Pool</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DateTime</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringReverseWorker</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">DateTime</span> <span class="nv">$createdAt</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/PoolTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Pool\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Pool\WorkerPool</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PoolTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetNewInstancesWithGet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkerPool</span><span class="p">();</span>
        <span class="nv">$worker1</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
        <span class="nv">$worker2</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$pool</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotSame</span><span class="p">(</span><span class="nv">$worker1</span><span class="p">,</span> <span class="nv">$worker2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetSameInstanceTwiceWhenDisposingItFirst</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WorkerPool</span><span class="p">();</span>
        <span class="nv">$worker1</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
        <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">dispose</span><span class="p">(</span><span class="nv">$worker1</span><span class="p">);</span>
        <span class="nv">$worker2</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$pool</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$worker1</span><span class="p">,</span> <span class="nv">$worker2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/Prototype/README"></span><div class="section" id="prototype">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Prototype_pattern">原型模式</a><a class="headerlink" href="#prototype" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>通过创建一个原型对象，然后复制原型对象来避免通过标准的方式创建大量的对象产生的开销(new Foo())。</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>大量的数据对象(比如通过ORM获取1,000,000行数据库记录然后创建每一条记录对应的对象实体)</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Prototype UML Diagram" class="align-center" src="_images/uml16.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/Prototype">GitHub</a> 上找到这些代码</p>
<p>BookPrototype.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">BookPrototype</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$title</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$category</span><span class="p">;</span>

    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTitle</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setTitle</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$title</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$title</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>BarBookPrototype.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BarBookPrototype</span> <span class="k">extends</span> <span class="nx">BookPrototype</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$category</span> <span class="o">=</span> <span class="s1">&#39;Bar&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>FooBookPrototype.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooBookPrototype</span> <span class="k">extends</span> <span class="nx">BookPrototype</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$category</span> <span class="o">=</span> <span class="s1">&#39;Foo&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/PrototypeTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Prototype\BarBookPrototype</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Prototype\FooBookPrototype</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PrototypeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetFooBook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$fooPrototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FooBookPrototype</span><span class="p">();</span>
        <span class="nv">$barPrototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BarBookPrototype</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$book</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$fooPrototype</span><span class="p">;</span>
            <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="s1">&#39;Foo Book No &#39;</span> <span class="o">.</span> <span class="nv">$i</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">FooBookPrototype</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$book</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$book</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$barPrototype</span><span class="p">;</span>
            <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="s1">&#39;Bar Book No &#39;</span> <span class="o">.</span> <span class="nv">$i</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">BarBookPrototype</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$book</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/SimpleFactory/README"></span><div class="section" id="simple-factory">
<h4>简单工厂<a class="headerlink" href="#simple-factory" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>简单的创建对象型工厂模式</p>
<p>It differs from the static factory because it is not static.
Therefore, you can have multiple factories, differently parameterized, you can subclass it and you can mock it.
It always should be preferred over a static factory!</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt SimpleFactory UML Diagram" class="align-center" src="_images/uml17.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/SimpleFactory">GitHub</a> 上找到这些代码</p>
<p>SimpleFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\SimpleFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SimpleFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createBicycle</span><span class="p">()</span><span class="o">:</span> <span class="nx">Bicycle</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Bicycle</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Bicycle.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\SimpleFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Bicycle</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">driveTo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$destination</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="usage">
<h5>Usage<a class="headerlink" href="#usage" title="永久链接至标题">¶</a></h5>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="x"> $factory = new SimpleFactory();</span>
<span class="x"> $bicycle = $factory-&gt;createBicycle();</span>
<span class="x"> $bicycle-&gt;driveTo(&#39;Paris&#39;);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/SimpleFactoryTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\SimpleFactory\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\SimpleFactory\Bicycle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\SimpleFactory\SimpleFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SimpleFactoryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCreateBicycle</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$bicycle</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">SimpleFactory</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">createBicycle</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Bicycle</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$bicycle</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/Singleton/README"></span><div class="section" id="singleton">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Singleton_pattern">单例模式</a><a class="headerlink" href="#singleton" title="永久链接至标题">¶</a></h4>
<p><strong>单例模式已经被考虑列入到反模式中！请使用依赖注入获得更好的代码可测试性和可控性！</strong></p>
<div class="section" id="purpose">
<h5>目标<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>使应用中只存在一个对象的实例，并且使这个单实例负责所有对该对象的调用。</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>数据库连接器</li>
<li>日志记录器</li>
<li>应用锁文件 （理论上整个应用只有一个锁文件 …）</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Singleton UML Diagram" class="align-center" src="_images/uml18.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/Singleton">GitHub</a> 上找到这些代码</p>
<p>Singleton.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Singleton</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Singleton</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="o">?</span><span class="nx">Singleton</span> <span class="nv">$instance</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * gets the instance via lazy initialization (created on first usage)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">()</span><span class="o">:</span> <span class="nx">Singleton</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="k">static</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * is not allowed to call from outside to prevent from creating multiple instances,</span>
<span class="sd">     * to use the singleton, you have to obtain the instance from Singleton::getInstance() instead</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * prevent the instance from being cloned (which would create a second instance of it)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * prevent from being unserialized (which would create a second instance of it)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/SingletonTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Singleton\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Creational\Singleton\Singleton</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SingletonTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUniqueness</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$firstCall</span> <span class="o">=</span> <span class="nx">Singleton</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
        <span class="nv">$secondCall</span> <span class="o">=</span> <span class="nx">Singleton</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Singleton</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$firstCall</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$firstCall</span><span class="p">,</span> <span class="nv">$secondCall</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Creational/StaticFactory/README"></span><div class="section" id="static-factory">
<h4>静态工厂<a class="headerlink" href="#static-factory" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>和抽象工厂类似，静态工厂模式用来创建一系列互相关联或依赖的对象，和抽象工厂模式不同的是静态工厂模式只用一个静态方法就解决了所有类型的对象创建，通常被命名为``工厂`` 或者 <code class="docutils literal notranslate"><span class="pre">构建器</span></code></p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt StaticFactory UML Diagram" class="align-center" src="_images/uml19.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Creational/StaticFactory">GitHub</a> 上找到这些代码</p>
<p>StaticFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\StaticFactory</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Note1: Remember, static means global state which is evil because it can&#39;t be mocked for tests</span>
<span class="sd"> * Note2: Cannot be subclassed or mock-upped or have multiple different instances.</span>
<span class="sd"> */</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">StaticFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">factory</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$type</span><span class="p">)</span><span class="o">:</span> <span class="nx">Formatter</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">FormatNumber</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">FormatString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Unknown format given&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Formatter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\StaticFactory</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Formatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$input</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>FormatString.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\StaticFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FormatString</span> <span class="k">implements</span> <span class="nx">Formatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$input</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$input</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>FormatNumber.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\StaticFactory</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FormatNumber</span> <span class="k">implements</span> <span class="nx">Formatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$input</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">number_format</span><span class="p">((</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$input</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/StaticFactoryTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\StaticFactory\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\StaticFactory\FormatNumber</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\StaticFactory\FormatString</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Creational\StaticFactory\StaticFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StaticFactoryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCreateNumberFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">FormatNumber</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">StaticFactory</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCreateStringFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">FormatString</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">StaticFactory</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testException</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nx">StaticFactory</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<span id="document-Structural/README"></span><div class="section" id="structural">
<h3><a class="reference external" href="http://en.wikipedia.org/wiki/Structural_pattern">结构型设计模式</a><a class="headerlink" href="#structural" title="永久链接至标题">¶</a></h3>
<p>在软件工程中，结构型设计模式集是用来抽象真实程序中的对象实体之间的关系，并使这种关系可被描述，概括和具体化。</p>
<div class="toctree-wrapper compound">
<span id="document-Structural/Adapter/README"></span><div class="section" id="adapter-wrapper">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Adapter_pattern">适配器模式</a><a class="headerlink" href="#adapter-wrapper" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>将某个类的接口转换成与另一个接口兼容。适配器通过将原始接口进行转换，给用户提供一个兼容接口，使得原来因为接口不同而无法一起使用的类可以得到兼容。</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>数据库客户端库适配器</li>
<li>使用不同的webservices，通过适配器来标准化输出数据，从而保证不同webservice输出的数据是一致的</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Adapter UML Diagram" class="align-center" src="_images/uml23.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Adapter">GitHub</a> 上找到这些代码</p>
<p>Book.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Adapter</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Book</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnPage</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPage</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PaperBook.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Adapter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PaperBook</span> <span class="k">implements</span> <span class="nx">Book</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$page</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnPage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">page</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPage</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">page</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>EBook.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Adapter</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">EBook</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">unlock</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">pressNext</span><span class="p">();</span>

    <span class="sd">/**</span>
<span class="sd">     * returns current page and total number of pages, like [10, 100] is page 10 of 100</span>
<span class="sd">     *</span>
<span class="sd">     * @return int[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPage</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>EBookAdapter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Adapter</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This is the adapter here. Notice it implements Book,</span>
<span class="sd"> * therefore you don&#39;t have to change the code of the client which is using a Book</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">EBookAdapter</span> <span class="k">implements</span> <span class="nx">Book</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">EBook</span> <span class="nv">$eBook</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">EBook</span> <span class="nv">$eBook</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eBook</span> <span class="o">=</span> <span class="nv">$eBook</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * This class makes the proper translation from one interface to another.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eBook</span><span class="o">-&gt;</span><span class="na">unlock</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnPage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eBook</span><span class="o">-&gt;</span><span class="na">pressNext</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * notice the adapted behavior here: EBook::getPage() will return two integers, but Book</span>
<span class="sd">     * supports only a current page getter, so we adapt the behavior here</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPage</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eBook</span><span class="o">-&gt;</span><span class="na">getPage</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Kindle.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Adapter</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * this is the adapted class. In production code, this could be a class from another package, some vendor code.</span>
<span class="sd"> * Notice that it uses another naming scheme and the implementation does something similar but in another way</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Kindle</span> <span class="k">implements</span> <span class="nx">EBook</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$totalPages</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">pressNext</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">page</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">unlock</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * returns current page and total number of pages, like [10, 100] is page 10 of 100</span>
<span class="sd">     *</span>
<span class="sd">     * @return int[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPage</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">page</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">totalPages</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/AdapterTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Adapter\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Adapter\PaperBook</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Adapter\EBookAdapter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Adapter\Kindle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AdapterTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanTurnPageOnBook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PaperBook</span><span class="p">();</span>
        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">();</span>
        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">turnPage</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getPage</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanTurnPageOnKindleLikeInANormalBook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$kindle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kindle</span><span class="p">();</span>
        <span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EBookAdapter</span><span class="p">(</span><span class="nv">$kindle</span><span class="p">);</span>

        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">();</span>
        <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">turnPage</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getPage</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Bridge/README"></span><div class="section" id="bridge">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Bridge_pattern">桥接模式</a><a class="headerlink" href="#bridge" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>解耦一个对象的实现与抽象，这样两者可以独立地变化。</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Bridge UML Diagram" class="align-center" src="_images/uml24.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Bridge">GitHub</a> 上找到这些代码</p>
<p>Formatter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Formatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PlainTextFormatter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PlainTextFormatter</span> <span class="k">implements</span> <span class="nx">Formatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>HtmlFormatter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HtmlFormatter</span> <span class="k">implements</span> <span class="nx">Formatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;%s&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Service.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Service</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">Formatter</span> <span class="nv">$implementation</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Formatter</span> <span class="nv">$printer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">implementation</span> <span class="o">=</span> <span class="nv">$printer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setImplementation</span><span class="p">(</span><span class="nx">Formatter</span> <span class="nv">$printer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">implementation</span> <span class="o">=</span> <span class="nv">$printer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>HelloWorldService.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloWorldService</span> <span class="k">extends</span> <span class="nx">Service</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">implementation</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PingService.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PingService</span> <span class="k">extends</span> <span class="nx">Service</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">implementation</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;pong&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/BridgeTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Bridge\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Bridge\HelloWorldService</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Bridge\HtmlFormatter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Bridge\PlainTextFormatter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BridgeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanPrintUsingThePlainTextFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HelloWorldService</span><span class="p">(</span><span class="k">new</span> <span class="nx">PlainTextFormatter</span><span class="p">());</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanPrintUsingTheHtmlFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HelloWorldService</span><span class="p">(</span><span class="k">new</span> <span class="nx">HtmlFormatter</span><span class="p">());</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;Hello World&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Composite/README"></span><div class="section" id="composite">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Composite_pattern">组合模式</a><a class="headerlink" href="#composite" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>以单个对象的方式来对待一组对象</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>form类的实例包含多个子元素，而它也像单个子元素那样响应render()请求，当调用``render()``方法时，它会历遍所有的子元素，调用``render()``方法</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Composite UML Diagram" class="align-center" src="_images/uml25.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Composite">GitHub</a> 上找到这些代码</p>
<p>Renderable.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Composite</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Renderable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Form.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Composite</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * The composite node MUST extend the component contract. This is mandatory for building</span>
<span class="sd"> * a tree of components.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Form</span> <span class="k">implements</span> <span class="nx">Renderable</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Renderable[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$elements</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * runs through all elements and calls render() on them, then returns the complete representation</span>
<span class="sd">     * of the form.</span>
<span class="sd">     *</span>
<span class="sd">     * from the outside, one will not see this and the form will act like a single object instance</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$formCode</span> <span class="o">=</span> <span class="s1">&#39;&lt;form&gt;&#39;</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">elements</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$formCode</span> <span class="o">.=</span> <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$formCode</span> <span class="o">.=</span> <span class="s1">&#39;&lt;/form&gt;&#39;</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$formCode</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addElement</span><span class="p">(</span><span class="nx">Renderable</span> <span class="nv">$element</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">elements</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$element</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>InputElement.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Composite</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InputElement</span> <span class="k">implements</span> <span class="nx">Renderable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;input type=&quot;text&quot; /&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>TextElement.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Composite</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TextElement</span> <span class="k">implements</span> <span class="nx">Renderable</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$text</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span> <span class="o">=</span> <span class="nv">$text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/CompositeTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Composite\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Composite\Form</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Composite\TextElement</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Composite\InputElement</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CompositeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testRender</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Form</span><span class="p">();</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="k">new</span> <span class="nx">TextElement</span><span class="p">(</span><span class="s1">&#39;Email:&#39;</span><span class="p">));</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="k">new</span> <span class="nx">InputElement</span><span class="p">());</span>
        <span class="nv">$embed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Form</span><span class="p">();</span>
        <span class="nv">$embed</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="k">new</span> <span class="nx">TextElement</span><span class="p">(</span><span class="s1">&#39;Password:&#39;</span><span class="p">));</span>
        <span class="nv">$embed</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="k">new</span> <span class="nx">InputElement</span><span class="p">());</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">addElement</span><span class="p">(</span><span class="nv">$embed</span><span class="p">);</span>

        <span class="c1">// This is just an example, in a real world scenario it is important to remember that web browsers do not</span>
        <span class="c1">// currently support nested forms</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;Email:&lt;input type=&quot;text&quot; /&gt;&lt;form&gt;Password:&lt;input type=&quot;text&quot; /&gt;&lt;/form&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
            <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/DataMapper/README"></span><div class="section" id="data-mapper">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Data_mapper_pattern">数据映射器</a><a class="headerlink" href="#data-mapper" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>数据映射器是一个数据访问层，用于将数据在持久性数据存储（通常是一个关系数据库）和内存中的数据表示（领域层）之间进行相互转换。其目的是为了将数据的内存表示、持久存储、数据访问进行分离。该层由一个或者多个映射器组成（或者数据访问对象），并且进行数据的转换。映射器的实现在范围上有所不同。通用映射器将处理许多不同领域的实体类型，而专用映射器将处理一个或几个。</p>
<p>此模式的主要特点是，与Active Record不同，其数据模式遵循单一职责原则(Single Responsibility Principle)。</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>DB Object Relational Mapper (ORM) : Doctrine2 使用 DAO “EntityRepository” 作为DAO</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt DataMapper UML Diagram" class="align-center" src="_images/uml26.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/DataMapper">GitHub</a> 上找到这些代码</p>
<p>User.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DataMapper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$username</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$email</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">fromState</span><span class="p">(</span><span class="k">array</span> <span class="nv">$state</span><span class="p">)</span><span class="o">:</span> <span class="nx">User</span>
    <span class="p">{</span>
        <span class="c1">// validate state before accessing keys!</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">self</span><span class="p">(</span>
            <span class="nv">$state</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
            <span class="nv">$state</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$username</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$email</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// validate parameters before setting them!</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="nv">$username</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">=</span> <span class="nv">$email</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUsername</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEmail</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UserMapper.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DataMapper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserMapper</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">StorageAdapter</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">StorageAdapter</span> <span class="nv">$storage</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="nv">$storage</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * finds a user from storage based on ID and returns a User object located</span>
<span class="sd">     * in memory. Normally this kind of logic will be implemented using the Repository pattern.</span>
<span class="sd">     * However the important part is in mapRowToUser() below, that will create a business object from the</span>
<span class="sd">     * data fetched from storage</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findById</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span><span class="o">:</span> <span class="nx">User</span>
    <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s2">&quot;User #</span><span class="si">$id</span><span class="s2"> not found&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapRowToUser</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">mapRowToUser</span><span class="p">(</span><span class="k">array</span> <span class="nv">$row</span><span class="p">)</span><span class="o">:</span> <span class="nx">User</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="na">fromState</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StorageAdapter.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DataMapper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StorageAdapter</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$data</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param int $id</span>
<span class="sd">     *</span>
<span class="sd">     * @return array|null</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$id</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/DataMapperTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DataMapper\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\DataMapper\StorageAdapter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\DataMapper\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\DataMapper\UserMapper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataMapperTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanMapUserFromStorage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StorageAdapter</span><span class="p">([</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;domnikl&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;liebler.dominik@gmail.com&#39;</span><span class="p">]]);</span>
        <span class="nv">$mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserMapper</span><span class="p">(</span><span class="nv">$storage</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$mapper</span><span class="o">-&gt;</span><span class="na">findById</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testWillNotMapInvalidData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$storage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StorageAdapter</span><span class="p">([]);</span>
        <span class="nv">$mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserMapper</span><span class="p">(</span><span class="nv">$storage</span><span class="p">);</span>

        <span class="nv">$mapper</span><span class="o">-&gt;</span><span class="na">findById</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Decorator/README"></span><div class="section" id="decorator">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Decorator_pattern">装饰器</a><a class="headerlink" href="#decorator" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>动态地为类的实例添加功能</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Web Service层：REST服务的JSON与XML装饰器（当然，在此只能使用其中的一种）</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Decorator UML Diagram" class="align-center" src="_images/uml27.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Decorator">GitHub</a> 上找到这些代码</p>
<p>Booking.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Booking</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculatePrice</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>BookingDecorator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">BookingDecorator</span> <span class="k">implements</span> <span class="nx">Booking</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">Booking</span> <span class="nv">$booking</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Booking</span> <span class="nv">$booking</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">booking</span> <span class="o">=</span> <span class="nv">$booking</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>DoubleRoomBooking.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DoubleRoomBooking</span> <span class="k">implements</span> <span class="nx">Booking</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculatePrice</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">40</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;double room&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>ExtraBed.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExtraBed</span> <span class="k">extends</span> <span class="nx">BookingDecorator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">PRICE</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculatePrice</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">booking</span><span class="o">-&gt;</span><span class="na">calculatePrice</span><span class="p">()</span> <span class="o">+</span> <span class="nx">self</span><span class="o">::</span><span class="na">PRICE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">booking</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39; with extra bed&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>WiFi.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">WiFi</span> <span class="k">extends</span> <span class="nx">BookingDecorator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">PRICE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">calculatePrice</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">booking</span><span class="o">-&gt;</span><span class="na">calculatePrice</span><span class="p">()</span> <span class="o">+</span> <span class="nx">self</span><span class="o">::</span><span class="na">PRICE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">booking</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39; with wifi&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/DecoratorTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Decorator\DoubleRoomBooking</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Decorator\ExtraBed</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Decorator\WiFi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DecoratorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCalculatePriceForBasicDoubleRoomBooking</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DoubleRoomBooking</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="nv">$booking</span><span class="o">-&gt;</span><span class="na">calculatePrice</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;double room&#39;</span><span class="p">,</span> <span class="nv">$booking</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCalculatePriceForDoubleRoomBookingWithWiFi</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DoubleRoomBooking</span><span class="p">();</span>
        <span class="nv">$booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WiFi</span><span class="p">(</span><span class="nv">$booking</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="nv">$booking</span><span class="o">-&gt;</span><span class="na">calculatePrice</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;double room with wifi&#39;</span><span class="p">,</span> <span class="nv">$booking</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanCalculatePriceForDoubleRoomBookingWithWiFiAndExtraBed</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DoubleRoomBooking</span><span class="p">();</span>
        <span class="nv">$booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WiFi</span><span class="p">(</span><span class="nv">$booking</span><span class="p">);</span>
        <span class="nv">$booking</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExtraBed</span><span class="p">(</span><span class="nv">$booking</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="nv">$booking</span><span class="o">-&gt;</span><span class="na">calculatePrice</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;double room with wifi with extra bed&#39;</span><span class="p">,</span> <span class="nv">$booking</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/DependencyInjection/README"></span><div class="section" id="dependency-injection">
<h4><cite>依赖注入</cite><a class="headerlink" href="#dependency-injection" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>实现了松耦合的软件架构，可得到更好的测试，管理和扩展的代码</p>
</div>
<div class="section" id="usage">
<h5>用例<a class="headerlink" href="#usage" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">DatabaseConfiguration</span></code> gets injected and <code class="docutils literal notranslate"><span class="pre">DatabaseConnection</span></code> will get all that it
needs from <code class="docutils literal notranslate"><span class="pre">$config</span></code>. Without DI, the configuration would be created
directly in <code class="docutils literal notranslate"><span class="pre">DatabaseConnection</span></code>, which is not very good for testing and
extending it.</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Doctrine2 ORM 使用了依赖注入，它通过配置注入了 <code class="docutils literal notranslate"><span class="pre">Connection</span></code> 对象。为了达到方便测试的目的，可以很容易的通过配置创建一个mock的``Connection`` 对象。</li>
<li>many frameworks already have containers for DI that
create objects via a configuration array and inject them where needed
(i.e. in Controllers)</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt DependencyInjection UML Diagram" class="align-center" src="_images/uml28.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/DependencyInjection">GitHub</a> 上找到这些代码</p>
<p>DatabaseConfiguration.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DependencyInjection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseConfiguration</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$port</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$username</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$password</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$host</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$port</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$username</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$password</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">host</span> <span class="o">=</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">port</span> <span class="o">=</span> <span class="nv">$port</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="nv">$username</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="nv">$password</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getHost</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">host</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPort</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">port</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUsername</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPassword</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>DatabaseConnection.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DependencyInjection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseConnection</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">DatabaseConfiguration</span> <span class="nv">$configuration</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">DatabaseConfiguration</span> <span class="nv">$config</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configuration</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDsn</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="c1">// this is just for the sake of demonstration, not a real DSN</span>
        <span class="c1">// notice that only the injected config is used here, so there is</span>
        <span class="c1">// a real separation of concerns here</span>

        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;%s:%s@%s:%d&#39;</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configuration</span><span class="o">-&gt;</span><span class="na">getUsername</span><span class="p">(),</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configuration</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">(),</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configuration</span><span class="o">-&gt;</span><span class="na">getHost</span><span class="p">(),</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configuration</span><span class="o">-&gt;</span><span class="na">getPort</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/DependencyInjectionTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\DependencyInjection\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\DependencyInjection\DatabaseConfiguration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\DependencyInjection\DatabaseConnection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DependencyInjectionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDependencyInjection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatabaseConfiguration</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">,</span> <span class="s1">&#39;domnikl&#39;</span><span class="p">,</span> <span class="s1">&#39;1234&#39;</span><span class="p">);</span>
        <span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatabaseConnection</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;domnikl:1234@localhost:3306&#39;</span><span class="p">,</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">getDsn</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Facade/README"></span><div class="section" id="facade">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Facade_pattern">外观模式</a><a class="headerlink" href="#facade" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>The primary goal of a Facade Pattern is not to avoid you having to read the
manual of a complex API. It’s only a side-effect. The first goal is to
reduce coupling and follow the Law of Demeter.</p>
<p>Facade通过嵌入多个（当然，有时只有一个）接口来解耦访客与子系统，当然也降低复杂度。</p>
<ul class="simple">
<li>Facade 不会禁止你访问子系统</li>
<li>你可以（应该）为一个子系统提供多个 Facade</li>
</ul>
<p>因此一个好的 Facade 里面不会有 <code class="docutils literal notranslate"><span class="pre">new</span></code> 。如果每个方法里都要构造多个对象，那么它就不是 Facade，而是生成器或者[抽象|静态|简单] 工厂 [方法]。</p>
<p>优秀的 Facade 不会有 <code class="docutils literal notranslate"><span class="pre">new</span></code>，并且构造函数参数是接口类型的。如果你需要创建一个新实例，则在参数中传入一个工厂对象。</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Facade UML Diagram" class="align-center" src="_images/uml29.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Facade">GitHub</a> 上找到这些代码</p>
<p>Facade.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Facade</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Facade</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">OperatingSystem</span> <span class="nv">$os</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">Bios</span> <span class="nv">$bios</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Bios</span> <span class="nv">$bios</span><span class="p">,</span> <span class="nx">OperatingSystem</span> <span class="nv">$os</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bios</span> <span class="o">=</span> <span class="nv">$bios</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">os</span> <span class="o">=</span> <span class="nv">$os</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnOn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bios</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bios</span><span class="o">-&gt;</span><span class="na">waitForKeyPress</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bios</span><span class="o">-&gt;</span><span class="na">launch</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">os</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnOff</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">os</span><span class="o">-&gt;</span><span class="na">halt</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bios</span><span class="o">-&gt;</span><span class="na">powerDown</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>OperatingSystem.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Facade</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">OperatingSystem</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">halt</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Bios.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Facade</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Bios</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">waitForKeyPress</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">launch</span><span class="p">(</span><span class="nx">OperatingSystem</span> <span class="nv">$os</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">powerDown</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/FacadeTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Facade\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Facade\Bios</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Facade\Facade</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Facade\OperatingSystem</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FacadeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testComputerOn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$os</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">OperatingSystem</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$os</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getName&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="s1">&#39;Linux&#39;</span><span class="p">));</span>

        <span class="nv">$bios</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">Bios</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$bios</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$os</span><span class="p">);</span>

        <span class="sd">/** @noinspection PhpParamsInspection */</span>
        <span class="nv">$facade</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Facade</span><span class="p">(</span><span class="nv">$bios</span><span class="p">,</span> <span class="nv">$os</span><span class="p">);</span>
        <span class="nv">$facade</span><span class="o">-&gt;</span><span class="na">turnOn</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;Linux&#39;</span><span class="p">,</span> <span class="nv">$os</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/FluentInterface/README"></span><div class="section" id="fluent-interface">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Fluent_interface">连贯接口</a><a class="headerlink" href="#fluent-interface" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>用来编写易于阅读的代码，就像自然语言一样（如英语）</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Doctrine2 的 QueryBuilder，就像下面例子中类似</li>
<li>PHPUnit 使用连贯接口来创建 mock 对象</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt FluentInterface UML Diagram" class="align-center" src="_images/uml30.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/FluentInterface">GitHub</a> 上找到这些代码</p>
<p>Sql.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\FluentInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Sql</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$from</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$where</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">select</span><span class="p">(</span><span class="k">array</span> <span class="nv">$fields</span><span class="p">)</span><span class="o">:</span> <span class="nx">Sql</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fields</span> <span class="o">=</span> <span class="nv">$fields</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">from</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$table</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$alias</span><span class="p">)</span><span class="o">:</span> <span class="nx">Sql</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$table</span><span class="o">.</span><span class="s1">&#39; AS &#39;</span><span class="o">.</span><span class="nv">$alias</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">where</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$condition</span><span class="p">)</span><span class="o">:</span> <span class="nx">Sql</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$condition</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;SELECT %s FROM %s WHERE %s&#39;</span><span class="p">,</span>
            <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fields</span><span class="p">),</span>
            <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">from</span><span class="p">),</span>
            <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; AND &#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/FluentInterfaceTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\FluentInterface\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\FluentInterface\Sql</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FluentInterfaceTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBuildSQL</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Sql</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;f.bar = ?&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;SELECT foo, bar FROM foobar AS f WHERE f.bar = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$query</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Flyweight/README"></span><div class="section" id="flyweight">
<h4><a class="reference external" href="https://en.wikipedia.org/wiki/Flyweight_pattern">Flyweight</a><a class="headerlink" href="#flyweight" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To minimise memory usage, a Flyweight shares as much as possible memory with similar objects. It
is needed when a large amount of objects is used that don’t differ much in state. A common practice is
to hold state in external data structures and pass them to the flyweight object when needed.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Flyweight UML Diagram" class="align-center" src="_images/uml31.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Flyweight">GitHub</a></p>
<p>Text.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Flyweight</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This is the interface that all flyweights need to implement</span>
<span class="sd"> */</span>
<span class="k">interface</span> <span class="nx">Text</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$extrinsicState</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Word.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Flyweight</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Word</span> <span class="k">implements</span> <span class="nx">Text</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$font</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Word %s with font %s&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span> <span class="nv">$font</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Character.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Flyweight</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Implements the flyweight interface and adds storage for intrinsic state, if any.</span>
<span class="sd"> * Instances of concrete flyweights are shared by means of a factory.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Character</span> <span class="k">implements</span> <span class="nx">Text</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Any state stored by the concrete flyweight must be independent of its context.</span>
<span class="sd">     * For flyweights representing characters, this is usually the corresponding character code.</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$font</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
         <span class="c1">// Clients supply the context-dependent information that the flyweight needs to draw itself</span>
         <span class="c1">// For flyweights representing characters, extrinsic state usually contains e.g. the font.</span>

        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Character %s with font %s&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span> <span class="nv">$font</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>TextFactory.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Flyweight</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Countable</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * A factory manages shared flyweights. Clients should not instantiate them directly,</span>
<span class="sd"> * but let the factory take care of returning existing objects or creating new ones.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">TextFactory</span> <span class="k">implements</span> <span class="nx">Countable</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Text[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$charPool</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span><span class="o">:</span> <span class="nx">Text</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">charPool</span><span class="p">[</span><span class="nv">$name</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">charPool</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">charPool</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span><span class="o">:</span> <span class="nx">Text</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Character</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">Word</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">charPool</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/FlyweightTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Flyweight\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Flyweight\TextFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FlyweightTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$characters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
        <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">];</span>

    <span class="k">private</span> <span class="k">array</span> <span class="nv">$fonts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="s1">&#39;Verdana&#39;</span><span class="p">,</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFlyweight</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextFactory</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">characters</span> <span class="k">as</span> <span class="nv">$char</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fonts</span> <span class="k">as</span> <span class="nv">$font</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$flyweight</span> <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$char</span><span class="p">);</span>
                    <span class="nv">$rendered</span> <span class="o">=</span> <span class="nv">$flyweight</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="nv">$font</span><span class="p">);</span>

                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Character %s with font %s&#39;</span><span class="p">,</span> <span class="nv">$char</span><span class="p">,</span> <span class="nv">$font</span><span class="p">),</span> <span class="nv">$rendered</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fonts</span> <span class="k">as</span> <span class="nv">$word</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$flyweight</span> <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$word</span><span class="p">);</span>
            <span class="nv">$rendered</span> <span class="o">=</span> <span class="nv">$flyweight</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">);</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Word %s with font foobar&#39;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">),</span> <span class="nv">$rendered</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Flyweight pattern ensures that instances are shared</span>
        <span class="c1">// instead of having hundreds of thousands of individual objects</span>
        <span class="c1">// there must be one instance for every char that has been reused for displaying in different fonts</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">characters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fonts</span><span class="p">),</span> <span class="nv">$factory</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Proxy/README"></span><div class="section" id="proxy">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Proxy_pattern">代理模式</a><a class="headerlink" href="#proxy" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>为昂贵或者无法复制的资源提供接口。</p>
</div>
<div class="section" id="examples">
<h5>例子<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Doctrine2 使用代理来实现框架特性（如延迟初始化），同时用户还是使用自己的实体类并且不会使用或者接触到代理</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Proxy UML Diagram" class="align-center" src="_images/uml32.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Proxy">GitHub</a> 上找到这些代码</p>
<p>BankAccount.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">BankAccount</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deposit</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$amount</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getBalance</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>HeavyBankAccount.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HeavyBankAccount</span> <span class="k">implements</span> <span class="nx">BankAccount</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var int[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$transactions</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">deposit</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$amount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">transactions</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getBalance</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="c1">// this is the heavy part, imagine all the transactions even from</span>
        <span class="c1">// years and decades ago must be fetched from a database or web service</span>
        <span class="c1">// and the balance must be calculated from it</span>

        <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">transactions</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>BankAccountProxy.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BankAccountProxy</span> <span class="k">extends</span> <span class="nx">HeavyBankAccount</span> <span class="k">implements</span> <span class="nx">BankAccount</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="o">?</span><span class="nx">int</span> <span class="nv">$balance</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getBalance</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="c1">// because calculating balance is so expensive,</span>
        <span class="c1">// the usage of BankAccount::getBalance() is delayed until it really is needed</span>
        <span class="c1">// and will not be calculated again for this instance</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">balance</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">balance</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">getBalance</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>ProxyTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Proxy\BankAccountProxy</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProxyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProxyWillOnlyExecuteExpensiveGetBalanceOnce</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$bankAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BankAccountProxy</span><span class="p">();</span>
        <span class="nv">$bankAccount</span><span class="o">-&gt;</span><span class="na">deposit</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

        <span class="c1">// this time balance is being calculated</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="nv">$bankAccount</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>

        <span class="c1">// inheritance allows for BankAccountProxy to behave to an outsider exactly like ServerBankAccount</span>
        <span class="nv">$bankAccount</span><span class="o">-&gt;</span><span class="na">deposit</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

        <span class="c1">// this time the previously calculated balance is returned again without re-calculating it</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="nv">$bankAccount</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Structural/Registry/README"></span><div class="section" id="registry">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Service_locator_pattern">注册模式</a><a class="headerlink" href="#registry" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>目的<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To implement a central storage for objects often used throughout the
application, is typically implemented using an abstract class with only
static methods (or using the Singleton pattern). Remember that this introduces
global state, which should be avoided at all times! Instead implement it using Dependency Injection!</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML 图<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Registry UML Diagram" class="align-center" src="_images/uml33.png" />
</div>
<div class="section" id="code">
<h5>代码<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>你可以在 <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Structural/Registry">GitHub</a> 上找到这些代码</p>
<p>Registry.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Registry</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Registry</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">LOGGER</span> <span class="o">=</span> <span class="s1">&#39;logger&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * this introduces global state in your application which can not be mocked up for testing</span>
<span class="sd">     * and is therefor considered an anti-pattern! Use dependency injection instead!</span>
<span class="sd">     *</span>
<span class="sd">     * @var Service[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">array</span> <span class="nv">$services</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">array</span> <span class="nv">$allowedKeys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">,</span> <span class="nx">Service</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$allowedKeys</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid key given&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">self</span><span class="o">::</span><span class="nv">$services</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">)</span><span class="o">:</span> <span class="nx">Service</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$allowedKeys</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$services</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid key given&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$services</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Service.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Registry</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Service</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>测试<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/RegistryTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Registry\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Registry\Registry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Structural\Registry\Service</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\MockObject\MockObject</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegistryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Service</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nx">MockObject</span> <span class="nv">$service</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="nx">Service</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSetAndGetLogger</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Registry</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="nx">Registry</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span><span class="p">,</span> <span class="nx">Registry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nx">Registry</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowsExceptionWhenTryingToSetInvalidKey</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nx">Registry</span><span class="o">::</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * notice @runInSeparateProcess here: without it, a previous test might have set it already and</span>
<span class="sd">     * testing would not be possible. That&#39;s why you should implement Dependency Injection where an</span>
<span class="sd">     * injected class may easily be replaced by a mockup</span>
<span class="sd">     *</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowsExceptionWhenTryingToGetNotSetKey</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nx">Registry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nx">Registry</span><span class="o">::</span><span class="na">LOGGER</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<span id="document-Behavioral/README"></span><div class="section" id="behavioral">
<h3><a class="reference external" href="http://en.wikipedia.org/wiki/Behavioral_pattern">Behavioral</a><a class="headerlink" href="#behavioral" title="永久链接至标题">¶</a></h3>
<p>In software engineering, behavioral design patterns are design patterns
that identify common communication patterns between objects and realize
these patterns. By doing so, these patterns increase flexibility in
carrying out this communication.</p>
<div class="toctree-wrapper compound">
<span id="document-Behavioral/ChainOfResponsibilities/README"></span><div class="section" id="chain-of-responsibilities">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Chain_of_responsibility_pattern">Chain Of Responsibilities</a><a class="headerlink" href="#chain-of-responsibilities" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To build a chain of objects to handle a call in sequential order. If one
object cannot handle a call, it delegates the call to the next in the
chain and so forth.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>logging framework, where each chain element decides autonomously what
to do with a log message</li>
<li>a Spam filter</li>
<li>Caching: first object is an instance of e.g. a Memcached Interface,
if that “misses” it delegates the call to the database interface</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt ChainOfResponsibility UML Diagram" class="align-center" src="_images/uml.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/ChainOfResponsibilities">GitHub</a></p>
<p>Handler.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Psr\Http\Message\RequestInterface</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Handler</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="o">?</span><span class="nx">Handler</span> <span class="nv">$successor</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Handler</span> <span class="nv">$handler</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">successor</span> <span class="o">=</span> <span class="nv">$handler</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * This approach by using a template method pattern ensures you that</span>
<span class="sd">     * each subclass will not forget to call the successor</span>
<span class="sd">     */</span>
    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$processed</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">processing</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$processed</span> <span class="o">===</span> <span class="k">null</span> <span class="o">&amp;&amp;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">successor</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// the request has not been processed by this handler =&gt; see the next</span>
            <span class="nv">$processed</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">successor</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$processed</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">abstract</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">processing</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Responsible/FastStorage.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Responsible</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Handler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Psr\Http\Message\RequestInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HttpInMemoryCacheHandler</span> <span class="k">extends</span> <span class="nx">Handler</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">,</span> <span class="o">?</span><span class="nx">Handler</span> <span class="nv">$successor</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$successor</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">processing</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;%s?%s&#39;</span><span class="p">,</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getUri</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getPath</span><span class="p">(),</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getUri</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span>
        <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Responsible/SlowStorage.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Responsible</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Handler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Psr\Http\Message\RequestInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SlowDatabaseHandler</span> <span class="k">extends</span> <span class="nx">Handler</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">processing</span><span class="p">(</span><span class="nx">RequestInterface</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span>
    <span class="p">{</span>
        <span class="c1">// this is a mockup, in production code you would ask a slow (compared to in-memory) DB for the results</span>

        <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/ChainTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Handler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Responsible\HttpInMemoryCacheHandler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\ChainOfResponsibilities\Responsible\SlowDatabaseHandler</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Psr\Http\Message\RequestInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Psr\Http\Message\UriInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ChainTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Handler</span> <span class="nv">$chain</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">chain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpInMemoryCacheHandler</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;/foo/bar?index=1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello In Memory!&#39;</span><span class="p">],</span>
            <span class="k">new</span> <span class="nx">SlowDatabaseHandler</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanRequestKeyInFastStorage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">UriInterface</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$uri</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getPath&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;/foo/bar&#39;</span><span class="p">);</span>
        <span class="nv">$uri</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getQuery&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;index=1&#39;</span><span class="p">);</span>

        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">RequestInterface</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getMethod&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getUri&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="nv">$uri</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;Hello In Memory!&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">chain</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanRequestKeyInSlowStorage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">UriInterface</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$uri</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getPath&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;/foo/baz&#39;</span><span class="p">);</span>
        <span class="nv">$uri</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getQuery&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">RequestInterface</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getMethod&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getUri&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="nv">$uri</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">chain</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Command/README"></span><div class="section" id="command">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Command_pattern">Command</a><a class="headerlink" href="#command" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To encapsulate invocation and decoupling.</p>
<p>We have an Invoker and a Receiver. This pattern uses a “Command” to
delegate the method call against the Receiver and presents the same
method “execute”. Therefore, the Invoker just knows to call “execute” to
process the Command of the client. The Receiver is decoupled from the
Invoker.</p>
<p>The second aspect of this pattern is the undo(), which undoes the method
execute(). Command can also be aggregated to combine more complex
commands with minimum copy-paste and relying on composition over
inheritance.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>A text editor : all events are commands which can be undone, stacked
and saved.</li>
<li>big CLI tools use subcommands to distribute various tasks and pack
them in “modules”, each of these can be implemented with the Command
pattern (e.g. vagrant)</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Command UML Diagram" class="align-center" src="_images/uml1.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Command">GitHub</a></p>
<p>Command.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * this is the most important method in the Command pattern,</span>
<span class="sd">     * The Receiver goes in the constructor.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UndoableCommand.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">UndoableCommand</span> <span class="k">extends</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * This method is used to undo change made by command execution</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">undo</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>HelloCommand.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This concrete command calls &quot;print&quot; on the Receiver, but an external</span>
<span class="sd"> * invoker just knows that it can call &quot;execute&quot;</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">HelloCommand</span> <span class="k">implements</span> <span class="nx">Command</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Receiver</span> <span class="nv">$output</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Each concrete command is built with different receivers.</span>
<span class="sd">     * There can be one, many or completely no receivers, but there can be other commands in the parameters</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Receiver</span> <span class="nv">$console</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span> <span class="o">=</span> <span class="nv">$console</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * execute and output &quot;Hello World&quot;.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// sometimes, there is no receiver and this is the command which does all the work</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>AddMessageDateCommand.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This concrete command tweaks receiver to add current date to messages</span>
<span class="sd"> * invoker just knows that it can call &quot;execute&quot;</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">AddMessageDateCommand</span> <span class="k">implements</span> <span class="nx">UndoableCommand</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Receiver</span> <span class="nv">$output</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Each concrete command is built with different receivers.</span>
<span class="sd">     * There can be one, many or completely no receivers, but there can be other commands in the parameters.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Receiver</span> <span class="nv">$console</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span> <span class="o">=</span> <span class="nv">$console</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute and make receiver to enable displaying messages date.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// sometimes, there is no receiver and this is the command which</span>
        <span class="c1">// does all the work</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span><span class="o">-&gt;</span><span class="na">enableDate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Undo the command and make receiver to disable displaying messages date.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">undo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// sometimes, there is no receiver and this is the command which</span>
        <span class="c1">// does all the work</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span><span class="o">-&gt;</span><span class="na">disableDate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Receiver.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Receiver is a specific service with its own contract and can be only concrete.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Receiver</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">bool</span> <span class="nv">$enableDate</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @var string[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$output</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">write</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableDate</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$str</span> <span class="o">.=</span> <span class="s1">&#39; [&#39;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;]&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$str</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOutput</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Enable receiver to display message date</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">enableDate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableDate</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Disable receiver to display message date</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">disableDate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableDate</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Invoker.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Invoker is using the command given to it.</span>
<span class="sd"> * Example : an Application in SF2.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Invoker</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Command</span> <span class="nv">$command</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * in the invoker we find this kind of method for subscribing the command</span>
<span class="sd">     * There can be also a stack, a list, a fixed set ...</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCommand</span><span class="p">(</span><span class="nx">Command</span> <span class="nv">$cmd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">command</span> <span class="o">=</span> <span class="nv">$cmd</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * executes the command; the invoker is the same whatever is the command</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">command</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/CommandTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\HelloCommand</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\Invoker</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\Receiver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CommandTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testInvocation</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$invoker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Invoker</span><span class="p">();</span>
        <span class="nv">$receiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Receiver</span><span class="p">();</span>

        <span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">setCommand</span><span class="p">(</span><span class="k">new</span> <span class="nx">HelloCommand</span><span class="p">(</span><span class="nv">$receiver</span><span class="p">));</span>
        <span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="nv">$receiver</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Tests/UndoableCommandTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Command\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\AddMessageDateCommand</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\HelloCommand</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\Invoker</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Command\Receiver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UndoableCommandTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testInvocation</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$invoker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Invoker</span><span class="p">();</span>
        <span class="nv">$receiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Receiver</span><span class="p">();</span>

        <span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">setCommand</span><span class="p">(</span><span class="k">new</span> <span class="nx">HelloCommand</span><span class="p">(</span><span class="nv">$receiver</span><span class="p">));</span>
        <span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="nv">$receiver</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">());</span>

        <span class="nv">$messageDateCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AddMessageDateCommand</span><span class="p">(</span><span class="nv">$receiver</span><span class="p">);</span>
        <span class="nv">$messageDateCommand</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

        <span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s2">&quot;Hello World</span><span class="se">\n</span><span class="s2">Hello World [&quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="nv">$receiver</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">());</span>

        <span class="nv">$messageDateCommand</span><span class="o">-&gt;</span><span class="na">undo</span><span class="p">();</span>

        <span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s2">&quot;Hello World</span><span class="se">\n</span><span class="s2">Hello World [&quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;]</span><span class="se">\n</span><span class="s2">Hello World&quot;</span><span class="p">,</span> <span class="nv">$receiver</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Iterator/README"></span><div class="section" id="iterator">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Iterator_pattern">Iterator</a><a class="headerlink" href="#iterator" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To make an object iterable and to make it appear like a collection of objects.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>to process a file line by line by just running over all lines (which
have an object representation) for a file (which of course is an
object, too)</li>
</ul>
</div>
<div class="section" id="note">
<h5>Note<a class="headerlink" href="#note" title="永久链接至标题">¶</a></h5>
<p>Standard PHP Library (SPL) defines an interface Iterator which is best
suited for this! Often you would want to implement the Countable
interface too, to allow <code class="docutils literal notranslate"><span class="pre">count($object)</span></code> on your iterable object</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Iterator UML Diagram" class="align-center" src="_images/uml2.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Iterator">GitHub</a></p>
<p>Book.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Book</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$author</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$title</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$title</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$author</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">author</span> <span class="o">=</span> <span class="nv">$author</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthor</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">author</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTitle</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthorAndTitle</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39; by &#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAuthor</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>BookList.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Countable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Iterator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BookList</span> <span class="k">implements</span> <span class="nx">Countable</span><span class="p">,</span> <span class="nx">Iterator</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Book[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$books</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addBook</span><span class="p">(</span><span class="nx">Book</span> <span class="nv">$book</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$book</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeBook</span><span class="p">(</span><span class="nx">Book</span> <span class="nv">$bookToRemove</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$book</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">()</span> <span class="o">===</span> <span class="nv">$bookToRemove</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">())</span> <span class="p">{</span>
                <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span><span class="o">:</span> <span class="nx">Book</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentIndex</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentIndex</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentIndex</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentIndex</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/IteratorTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Iterator\Book</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Iterator\BookList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">IteratorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanIterateOverBookList</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$bookList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookList</span><span class="p">();</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Learning PHP Design Patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;William Sanders&#39;</span><span class="p">));</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Professional Php Design Patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;Aaron Saray&#39;</span><span class="p">));</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Clean Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Robert C. Martin&#39;</span><span class="p">));</span>

        <span class="nv">$books</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$bookList</span> <span class="k">as</span> <span class="nv">$book</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$books</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;Learning PHP Design Patterns by William Sanders&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Professional Php Design Patterns by Aaron Saray&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Clean Code by Robert C. Martin&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="nv">$books</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanIterateOverBookListAfterRemovingBook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Clean Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Robert C. Martin&#39;</span><span class="p">);</span>
        <span class="nv">$book2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Professional Php Design Patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;Aaron Saray&#39;</span><span class="p">);</span>

        <span class="nv">$bookList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookList</span><span class="p">();</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="nv">$book</span><span class="p">);</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="nv">$book2</span><span class="p">);</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">removeBook</span><span class="p">(</span><span class="nv">$book</span><span class="p">);</span>

        <span class="nv">$books</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$bookList</span> <span class="k">as</span> <span class="nv">$book</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$books</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Professional Php Design Patterns by Aaron Saray&#39;</span><span class="p">],</span>
            <span class="nv">$books</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanAddBookToList</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Clean Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Robert C. Martin&#39;</span><span class="p">);</span>

        <span class="nv">$bookList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookList</span><span class="p">();</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="nv">$book</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$bookList</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanRemoveBookFromList</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$book</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Clean Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Robert C. Martin&#39;</span><span class="p">);</span>

        <span class="nv">$bookList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookList</span><span class="p">();</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="nv">$book</span><span class="p">);</span>
        <span class="nv">$bookList</span><span class="o">-&gt;</span><span class="na">removeBook</span><span class="p">(</span><span class="nv">$book</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$bookList</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Mediator/README"></span><div class="section" id="mediator">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Mediator_pattern">Mediator</a><a class="headerlink" href="#mediator" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>This pattern provides an easy way to decouple many components working
together. It is a good alternative to Observer IF you have a “central
intelligence”, like a controller (but not in the sense of the MVC).</p>
<p>All components (called Colleague) are only coupled to the
Mediator interface and it is a good thing because in OOP, one good friend
is better than many. This is the key-feature of this pattern.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Mediator UML Diagram" class="align-center" src="_images/uml3.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Mediator">GitHub</a></p>
<p>Mediator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Mediator</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Mediator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUser</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$username</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Colleague.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Mediator</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Colleague</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nx">Mediator</span> <span class="nv">$mediator</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMediator</span><span class="p">(</span><span class="nx">Mediator</span> <span class="nv">$mediator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mediator</span> <span class="o">=</span> <span class="nv">$mediator</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Ui.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Mediator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Ui</span> <span class="k">extends</span> <span class="nx">Colleague</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">outputUserInfo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$username</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mediator</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UserRepository.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Mediator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserRepository</span> <span class="k">extends</span> <span class="nx">Colleague</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUserName</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;User: &#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UserRepositoryUiMediator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Mediator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserRepositoryUiMediator</span> <span class="k">implements</span> <span class="nx">Mediator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">UserRepository</span> <span class="nv">$userRepository</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">Ui</span> <span class="nv">$ui</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">UserRepository</span> <span class="nv">$userRepository</span><span class="p">,</span> <span class="nx">Ui</span> <span class="nv">$ui</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userRepository</span> <span class="o">=</span> <span class="nv">$userRepository</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ui</span> <span class="o">=</span> <span class="nv">$ui</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userRepository</span><span class="o">-&gt;</span><span class="na">setMediator</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ui</span><span class="o">-&gt;</span><span class="na">setMediator</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">printInfoAbout</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ui</span><span class="o">-&gt;</span><span class="na">outputUserInfo</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUser</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$username</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userRepository</span><span class="o">-&gt;</span><span class="na">getUserName</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/MediatorTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Tests\Mediator\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Mediator\Ui</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Mediator\UserRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Mediator\UserRepositoryUiMediator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MediatorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOutputHelloWorld</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$mediator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserRepositoryUiMediator</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserRepository</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">Ui</span><span class="p">());</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">&#39;User: Dominik&#39;</span><span class="p">);</span>
        <span class="nv">$mediator</span><span class="o">-&gt;</span><span class="na">printInfoAbout</span><span class="p">(</span><span class="s1">&#39;Dominik&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Memento/README"></span><div class="section" id="memento">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Memento_pattern">Memento</a><a class="headerlink" href="#memento" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>It provides the ability to restore an object to it’s previous state (undo
via rollback) or to gain access to state of the object, without revealing
it’s implementation (i.e., the object is not required to have a function
to return the current state).</p>
<p>The memento pattern is implemented with three objects: the Originator, a
Caretaker and a Memento.</p>
<p>Memento – an object that <em>contains a concrete unique snapshot of state</em> of
any object or resource: string, number, array, an instance of class and so on.
The uniqueness in this case does not imply the prohibition existence of similar
states in different snapshots. That means the state can be extracted as
the independent clone. Any object stored in the Memento should be
<em>a full copy of the original object rather than a reference</em> to the original
object. The Memento object is a “opaque object” (the object that no one can
or should change).</p>
<p>Originator – it is an object that contains the <em>actual state of an external
object is strictly specified type</em>. Originator is able to create a unique
copy of this state and return it wrapped in a Memento. The Originator does
not know the history of changes. You can set a concrete state to Originator
from the outside, which will be considered as actual. The Originator must
make sure that given state corresponds the allowed type of object. Originator
may (but not should) have any methods, but they <em>they can’t make changes to
the saved object state</em>.</p>
<p>Caretaker <em>controls the states history</em>. He may make changes to an object;
take a decision to save the state of an external object in the Originator;
ask from the Originator snapshot of the current state; or set the Originator
state to equivalence with some snapshot from history.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>The seed of a pseudorandom number generator</li>
<li>The state in a finite state machine</li>
<li>Control for intermediate states of <a class="reference external" href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM Model</a> before saving</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Momento UML Diagram" class="align-center" src="_images/uml4.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Memento">GitHub</a></p>
<p>Memento.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Memento</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Memento</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">State</span> <span class="nv">$state</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">State</span> <span class="nv">$stateToSave</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span> <span class="o">=</span> <span class="nv">$stateToSave</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getState</span><span class="p">()</span><span class="o">:</span> <span class="nx">State</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>State.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Memento</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">State</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">STATE_CREATED</span> <span class="o">=</span> <span class="s1">&#39;created&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATE_OPENED</span> <span class="o">=</span> <span class="s1">&#39;opened&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATE_ASSIGNED</span> <span class="o">=</span> <span class="s1">&#39;assigned&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATE_CLOSED</span> <span class="o">=</span> <span class="s1">&#39;closed&#39;</span><span class="p">;</span>

    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$state</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @var string[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">array</span> <span class="nv">$validStates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATE_CREATED</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATE_OPENED</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATE_ASSIGNED</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATE_CLOSED</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$state</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">ensureIsValidState</span><span class="p">(</span><span class="nv">$state</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">ensureIsValidState</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$state</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$state</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$validStates</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid state given&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Ticket.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Memento</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Ticket is the &quot;Originator&quot; in this implementation</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Ticket</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">State</span> <span class="nv">$currentState</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">State</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_CREATED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">open</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">State</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_OPENED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">assign</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">State</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_ASSIGNED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">State</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_CLOSED</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">saveToMemento</span><span class="p">()</span><span class="o">:</span> <span class="nx">Memento</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Memento</span><span class="p">(</span><span class="k">clone</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">restoreFromMemento</span><span class="p">(</span><span class="nx">Memento</span> <span class="nv">$memento</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span> <span class="o">=</span> <span class="nv">$memento</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getState</span><span class="p">()</span><span class="o">:</span> <span class="nx">State</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentState</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/MementoTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Memento\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Memento\State</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Memento\Ticket</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MementoTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOpenTicketAssignAndSetBackToOpen</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$ticket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">();</span>

        <span class="c1">// open the ticket</span>
        <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">open</span><span class="p">();</span>
        <span class="nv">$openedState</span> <span class="o">=</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_OPENED</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">());</span>

        <span class="nv">$memento</span> <span class="o">=</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">saveToMemento</span><span class="p">();</span>

        <span class="c1">// assign the ticket</span>
        <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">assign</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_ASSIGNED</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">());</span>

        <span class="c1">// now restore to the opened state, but verify that the state object has been cloned for the memento</span>
        <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">restoreFromMemento</span><span class="p">(</span><span class="nv">$memento</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nx">State</span><span class="o">::</span><span class="na">STATE_OPENED</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotSame</span><span class="p">(</span><span class="nv">$openedState</span><span class="p">,</span> <span class="nv">$ticket</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/NullObject/README"></span><div class="section" id="null-object">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Null_Object_pattern">Null Object</a><a class="headerlink" href="#null-object" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>NullObject is not a GoF design pattern but a schema which appears
frequently enough to be considered a pattern. It has the following
benefits:</p>
<ul class="simple">
<li>Client code is simplified</li>
<li>Reduces the chance of null pointer exceptions</li>
<li>Fewer conditionals require less test cases</li>
</ul>
<p>Methods that return an object or null should instead return an object or
<code class="docutils literal notranslate"><span class="pre">NullObject</span></code>. <code class="docutils literal notranslate"><span class="pre">NullObject</span></code>s simplify boilerplate code such as
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(!is_null($obj))</span> <span class="pre">{</span> <span class="pre">$obj-&gt;callSomething();</span> <span class="pre">}</span></code> to just
<code class="docutils literal notranslate"><span class="pre">$obj-&gt;callSomething();</span></code> by eliminating the conditional check in
client code.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Null logger or null output to preserve a standard way of interaction between objects, even if the shouldn’t do anything</li>
<li>null handler in a Chain of Responsibilities pattern</li>
<li>null command in a Command pattern</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt NullObject UML Diagram" class="align-center" src="_images/uml5.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/NullObject">GitHub</a></p>
<p>Service.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\NullObject</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Service</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Logger</span> <span class="nv">$logger</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Logger</span> <span class="nv">$logger</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * do something ...</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// notice here that you don&#39;t have to check if the logger is set with eg. is_null(), instead just use it</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;We are in &#39;</span><span class="o">.</span><span class="no">__METHOD__</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Logger.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\NullObject</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Key feature: NullLogger must inherit from this interface like any other loggers</span>
<span class="sd"> */</span>
<span class="k">interface</span> <span class="nx">Logger</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PrintLogger.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\NullObject</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PrintLogger</span> <span class="k">implements</span> <span class="nx">Logger</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$str</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>NullLogger.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\NullObject</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NullLogger</span> <span class="k">implements</span> <span class="nx">Logger</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// do nothing</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/LoggerTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\NullObject\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\NullObject\NullLogger</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\NullObject\PrintLogger</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\NullObject\Service</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoggerTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testNullObject</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">(</span><span class="k">new</span> <span class="nx">NullLogger</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testStandardLogger</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">(</span><span class="k">new</span> <span class="nx">PrintLogger</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">&#39;We are in DesignPatterns\Behavioral\NullObject\Service::doSomething&#39;</span><span class="p">);</span>
        <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Observer/README"></span><div class="section" id="observer">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Observer_pattern">Observer</a><a class="headerlink" href="#observer" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To implement a publish/subscribe behaviour to an object, whenever a
“Subject” object changes its state, the attached “Observers” will be
notified. It is used to shorten the amount of coupled objects and uses
loose coupling instead.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>a message queue system is observed to show the progress of a job in a
GUI</li>
</ul>
</div>
<div class="section" id="note">
<h5>Note<a class="headerlink" href="#note" title="永久链接至标题">¶</a></h5>
<p>PHP already defines two interfaces that can help to implement this
pattern: SplObserver and SplSubject.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Observer UML Diagram" class="align-center" src="_images/uml6.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Observer">GitHub</a></p>
<p>User.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Observer</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">SplSubject</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">SplObjectStorage</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">SplObserver</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * User implements the observed object (called Subject), it maintains a list of observers and sends notifications to</span>
<span class="sd"> * them in case changes are made on the User object</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">SplSubject</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$email</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">SplObjectStorage</span> <span class="nv">$observers</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplObjectStorage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">SplObserver</span> <span class="nv">$observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">detach</span><span class="p">(</span><span class="nx">SplObserver</span> <span class="nv">$observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">changeEmail</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$email</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span> <span class="o">=</span> <span class="nv">$email</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="sd">/** @var SplObserver $observer */</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="k">as</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>UserObserver.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Observer</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">SplObserver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">SplSubject</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserObserver</span> <span class="k">implements</span> <span class="nx">SplObserver</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var SplSubject[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$changedUsers</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * It is called by the Subject, usually by SplSubject::notify()</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">SplSubject</span> <span class="nv">$subject</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">changedUsers</span><span class="p">[]</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$subject</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return SplSubject[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getChangedUsers</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">changedUsers</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/ObserverTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Observer\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Observer\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Observer\UserObserver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ObserverTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testChangeInUserLeadsToUserObserverBeingNotified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserObserver</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">changeEmail</span><span class="p">(</span><span class="s1">&#39;foo@bar.com&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">getChangedUsers</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Specification/README"></span><div class="section" id="specification">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Specification_pattern">Specification</a><a class="headerlink" href="#specification" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>Builds a clear specification of business rules, where objects can be
checked against. The composite specification class has one method called
<code class="docutils literal notranslate"><span class="pre">isSatisfiedBy</span></code> that returns either true or false depending on whether
the given object satisfies the specification.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/K-Phoen/rulerz">RulerZ</a></li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Specification UML Diagram" class="align-center" src="_images/uml7.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Specification">GitHub</a></p>
<p>Item.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Item</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">float</span> <span class="nv">$price</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">float</span> <span class="nv">$price</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">price</span> <span class="o">=</span> <span class="nv">$price</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPrice</span><span class="p">()</span><span class="o">:</span> <span class="nx">float</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">price</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Specification.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Specification</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isSatisfiedBy</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$item</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>OrSpecification.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrSpecification</span> <span class="k">implements</span> <span class="nx">Specification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Specification[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$specifications</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param Specification[] $specifications</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Specification</span> <span class="o">...</span><span class="nv">$specifications</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specifications</span> <span class="o">=</span> <span class="nv">$specifications</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/*</span>
<span class="cm">     * if at least one specification is true, return true, else return false</span>
<span class="cm">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isSatisfiedBy</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$item</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specifications</span> <span class="k">as</span> <span class="nv">$specification</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$specification</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="nv">$item</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PriceSpecification.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PriceSpecification</span> <span class="k">implements</span> <span class="nx">Specification</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="o">?</span><span class="nx">float</span> <span class="nv">$maxPrice</span><span class="p">;</span>
    <span class="k">private</span> <span class="o">?</span><span class="nx">float</span> <span class="nv">$minPrice</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="o">?</span><span class="nx">float</span> <span class="nv">$minPrice</span><span class="p">,</span> <span class="o">?</span><span class="nx">float</span> <span class="nv">$maxPrice</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">minPrice</span> <span class="o">=</span> <span class="nv">$minPrice</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxPrice</span> <span class="o">=</span> <span class="nv">$maxPrice</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isSatisfiedBy</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$item</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxPrice</span> <span class="o">!==</span> <span class="k">null</span> <span class="o">&amp;&amp;</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">getPrice</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">maxPrice</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">minPrice</span> <span class="o">!==</span> <span class="k">null</span> <span class="o">&amp;&amp;</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">getPrice</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">minPrice</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>AndSpecification.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AndSpecification</span> <span class="k">implements</span> <span class="nx">Specification</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Specification[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$specifications</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param Specification[] $specifications</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Specification</span> <span class="o">...</span><span class="nv">$specifications</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specifications</span> <span class="o">=</span> <span class="nv">$specifications</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * if at least one specification is false, return false, else return true.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">isSatisfiedBy</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$item</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specifications</span> <span class="k">as</span> <span class="nv">$specification</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$specification</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="nv">$item</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>NotSpecification.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NotSpecification</span> <span class="k">implements</span> <span class="nx">Specification</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Specification</span> <span class="nv">$specification</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Specification</span> <span class="nv">$specification</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specification</span> <span class="o">=</span> <span class="nv">$specification</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isSatisfiedBy</span><span class="p">(</span><span class="nx">Item</span> <span class="nv">$item</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">specification</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="nv">$item</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/SpecificationTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Specification\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Specification\Item</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Specification\NotSpecification</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Specification\OrSpecification</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Specification\AndSpecification</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Specification\PriceSpecification</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SpecificationTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanOr</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$spec1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PriceSpecification</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">99</span><span class="p">);</span>
        <span class="nv">$spec2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PriceSpecification</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

        <span class="nv">$orSpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrSpecification</span><span class="p">(</span><span class="nv">$spec1</span><span class="p">,</span> <span class="nv">$spec2</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$orSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">100</span><span class="p">)));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$orSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">51</span><span class="p">)));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$orSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">150</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanAnd</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$spec1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PriceSpecification</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="nv">$spec2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PriceSpecification</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

        <span class="nv">$andSpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AndSpecification</span><span class="p">(</span><span class="nv">$spec1</span><span class="p">,</span> <span class="nv">$spec2</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$andSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">150</span><span class="p">)));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$andSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$andSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">51</span><span class="p">)));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$andSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">100</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanNot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$spec1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PriceSpecification</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
        <span class="nv">$notSpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NotSpecification</span><span class="p">(</span><span class="nv">$spec1</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$notSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">150</span><span class="p">)));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$notSpec</span><span class="o">-&gt;</span><span class="na">isSatisfiedBy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="mi">50</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/State/README"></span><div class="section" id="state">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/State_pattern">State</a><a class="headerlink" href="#state" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>Encapsulate varying behavior for the same routine based on an object’s
state. This can be a cleaner way for an object to change its behavior at
runtime without resorting to large monolithic conditional statements.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt State UML Diagram" class="align-center" src="_images/uml8.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/State">GitHub</a></p>
<p>OrderContext.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\State</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderContext</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">State</span> <span class="nv">$state</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span><span class="o">:</span> <span class="nx">OrderContext</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">self</span><span class="p">();</span>
        <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StateCreated</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$order</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setState</span><span class="p">(</span><span class="nx">State</span> <span class="nv">$state</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">proceedToNext</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>State.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\State</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">proceedToNext</span><span class="p">(</span><span class="nx">OrderContext</span> <span class="nv">$context</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StateCreated.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\State</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StateCreated</span> <span class="k">implements</span> <span class="nx">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">proceedToNext</span><span class="p">(</span><span class="nx">OrderContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="k">new</span> <span class="nx">StateShipped</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;created&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StateShipped.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\State</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StateShipped</span> <span class="k">implements</span> <span class="nx">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">proceedToNext</span><span class="p">(</span><span class="nx">OrderContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="k">new</span> <span class="nx">StateDone</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;shipped&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>StateDone.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\State</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StateDone</span> <span class="k">implements</span> <span class="nx">State</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">proceedToNext</span><span class="p">(</span><span class="nx">OrderContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// there is nothing more to do</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;done&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/StateTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\State\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\State\OrderContext</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StateTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIsCreatedWithStateCreated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$orderContext</span> <span class="o">=</span> <span class="nx">OrderContext</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="nv">$orderContext</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanProceedToStateShipped</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$contextOrder</span> <span class="o">=</span> <span class="nx">OrderContext</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>
        <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;shipped&#39;</span><span class="p">,</span> <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanProceedToStateDone</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$contextOrder</span> <span class="o">=</span> <span class="nx">OrderContext</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>
        <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">();</span>
        <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testStateDoneIsTheLastPossibleState</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$contextOrder</span> <span class="o">=</span> <span class="nx">OrderContext</span><span class="o">::</span><span class="na">create</span><span class="p">();</span>
        <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">();</span>
        <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">();</span>
        <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">proceedToNext</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="nv">$contextOrder</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Strategy/README"></span><div class="section" id="strategy">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy</a><a class="headerlink" href="#strategy" title="永久链接至标题">¶</a></h4>
<div class="section" id="terminology">
<h5>Terminology:<a class="headerlink" href="#terminology" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Context</li>
<li>Strategy</li>
<li>Concrete Strategy</li>
</ul>
</div>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To separate strategies and to enable fast switching between them. Also
this pattern is a good alternative to inheritance (instead of having an
abstract class that is extended).</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>sorting a list of objects, one strategy by date, the other by id</li>
<li>simplify unit testing: e.g. switching between file and in-memory
storage</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Strategy UML Diagram" class="align-center" src="_images/uml9.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Strategy">GitHub</a></p>
<p>Context.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Strategy</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Context</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Comparator</span> <span class="nv">$comparator</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Comparator</span> <span class="nv">$comparator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">comparator</span> <span class="o">=</span> <span class="nv">$comparator</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">executeStrategy</span><span class="p">(</span><span class="k">array</span> <span class="nv">$elements</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="nb">uasort</span><span class="p">(</span><span class="nv">$elements</span><span class="p">,</span> <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">comparator</span><span class="p">,</span> <span class="s1">&#39;compare&#39;</span><span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$elements</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Comparator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Strategy</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Comparator</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @param mixed $a</span>
<span class="sd">     * @param mixed $b</span>
<span class="sd">     *</span>
<span class="sd">     * @return int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>DateComparator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Strategy</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DateTime</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DateComparator</span> <span class="k">implements</span> <span class="nx">Comparator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="nv">$aDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]);</span>
        <span class="nv">$bDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$aDate</span> <span class="o">&lt;=&gt;</span> <span class="nv">$bDate</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>IdComparator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Strategy</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">IdComparator</span> <span class="k">implements</span> <span class="nx">Comparator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">&lt;=&gt;</span> <span class="nv">$b</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/StrategyTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Strategy\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Strategy\Context</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Strategy\DateComparator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Strategy\IdComparator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StrategyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provideIntegers</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="p">[[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]],</span>
                <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="p">[[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]],</span>
                <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">provideDates</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="p">[[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2014-03-03&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2015-03-02&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2013-03-01&#39;</span><span class="p">]],</span>
                <span class="p">[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2013-03-01&#39;</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="p">[[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2014-02-03&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2013-02-01&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2015-02-02&#39;</span><span class="p">]],</span>
                <span class="p">[</span><span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2013-02-01&#39;</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @dataProvider provideIntegers</span>
<span class="sd">     *</span>
<span class="sd">     * @param array $collection</span>
<span class="sd">     * @param array $expected</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIdComparator</span><span class="p">(</span><span class="nv">$collection</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">(</span><span class="k">new</span> <span class="nx">IdComparator</span><span class="p">());</span>
        <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">executeStrategy</span><span class="p">(</span><span class="nv">$collection</span><span class="p">);</span>

        <span class="nv">$firstElement</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$elements</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$firstElement</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @dataProvider provideDates</span>
<span class="sd">     *</span>
<span class="sd">     * @param array $collection</span>
<span class="sd">     * @param array $expected</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDateComparator</span><span class="p">(</span><span class="nv">$collection</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateComparator</span><span class="p">());</span>
        <span class="nv">$elements</span> <span class="o">=</span> <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">executeStrategy</span><span class="p">(</span><span class="nv">$collection</span><span class="p">);</span>

        <span class="nv">$firstElement</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$elements</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$firstElement</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/TemplateMethod/README"></span><div class="section" id="template-method">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Template_method_pattern">Template Method</a><a class="headerlink" href="#template-method" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>Template Method is a behavioral design pattern.</p>
<p>Perhaps you have encountered it many times already. The idea is to let
subclasses of this abstract template “finish” the behavior of an
algorithm.</p>
<p>A.k.a the “Hollywood principle”: “Don’t call us, we call you.” This
class is not called by subclasses but the inverse. How? With abstraction
of course.</p>
<p>In other words, this is a skeleton of algorithm, well-suited for
framework libraries. The user has just to implement one method and the
superclass do the job.</p>
<p>It is an easy way to decouple concrete classes and reduce copy-paste,
that’s why you’ll find it everywhere.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt TemplateMethod UML Diagram" class="align-center" src="_images/uml10.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/TemplateMethod">GitHub</a></p>
<p>Journey.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\TemplateMethod</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Journey</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var string[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$thingsToDo</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * This is the public service provided by this class and its subclasses.</span>
<span class="sd">     * Notice it is final to &quot;freeze&quot; the global behavior of algorithm.</span>
<span class="sd">     * If you want to override this contract, make an interface with only takeATrip()</span>
<span class="sd">     * and subclass it.</span>
<span class="sd">     */</span>
    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">takeATrip</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">thingsToDo</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buyAFlight</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">thingsToDo</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">takePlane</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">thingsToDo</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enjoyVacation</span><span class="p">();</span>
        <span class="nv">$buyGift</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buyGift</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$buyGift</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">thingsToDo</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$buyGift</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">thingsToDo</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">takePlane</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * This method must be implemented, this is the key-feature of this pattern.</span>
<span class="sd">     */</span>
    <span class="k">abstract</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">enjoyVacation</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * This method is also part of the algorithm but it is optional.</span>
<span class="sd">     * You can override it only if you need to</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">buyGift</span><span class="p">()</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">buyAFlight</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Buy a flight ticket&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">takePlane</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;Taking the plane&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return string[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getThingsToDo</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">thingsToDo</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>BeachJourney.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\TemplateMethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BeachJourney</span> <span class="k">extends</span> <span class="nx">Journey</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">enjoyVacation</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;Swimming and sun-bathing&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>CityJourney.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\TemplateMethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CityJourney</span> <span class="k">extends</span> <span class="nx">Journey</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">enjoyVacation</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;Eat, drink, take photos and sleep&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">buyGift</span><span class="p">()</span><span class="o">:</span> <span class="o">?</span><span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;Buy a gift&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/JourneyTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\TemplateMethod\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\TemplateMethod\BeachJourney</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\TemplateMethod\CityJourney</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">JourneyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetOnVacationOnTheBeach</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$beachJourney</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BeachJourney</span><span class="p">();</span>
        <span class="nv">$beachJourney</span><span class="o">-&gt;</span><span class="na">takeATrip</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Buy a flight ticket&#39;</span><span class="p">,</span> <span class="s1">&#39;Taking the plane&#39;</span><span class="p">,</span> <span class="s1">&#39;Swimming and sun-bathing&#39;</span><span class="p">,</span> <span class="s1">&#39;Taking the plane&#39;</span><span class="p">],</span>
            <span class="nv">$beachJourney</span><span class="o">-&gt;</span><span class="na">getThingsToDo</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGetOnAJourneyToACity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$cityJourney</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CityJourney</span><span class="p">();</span>
        <span class="nv">$cityJourney</span><span class="o">-&gt;</span><span class="na">takeATrip</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;Buy a flight ticket&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Taking the plane&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Eat, drink, take photos and sleep&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Buy a gift&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Taking the plane&#39;</span>
            <span class="p">],</span>
            <span class="nv">$cityJourney</span><span class="o">-&gt;</span><span class="na">getThingsToDo</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-Behavioral/Visitor/README"></span><div class="section" id="visitor">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor</a><a class="headerlink" href="#visitor" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>The Visitor Pattern lets you outsource operations on objects to other
objects. The main reason to do this is to keep a separation of concerns.
But classes have to define a contract to allow visitors (the
<code class="docutils literal notranslate"><span class="pre">Role::accept</span></code> method in the example).</p>
<p>The contract is an abstract class but you can have also a clean
interface. In that case, each Visitor has to choose itself which method
to invoke on the visitor.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Visitor UML Diagram" class="align-center" src="_images/uml11.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/Behavioral/Visitor">GitHub</a></p>
<p>RoleVisitor.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Visitor</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Note: the visitor must not choose itself which method to</span>
<span class="sd"> * invoke, it is the visited object that makes this decision</span>
<span class="sd"> */</span>
<span class="k">interface</span> <span class="nx">RoleVisitor</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitUser</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$role</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitGroup</span><span class="p">(</span><span class="nx">Group</span> <span class="nv">$role</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>RecordingVisitor.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Visitor</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RecordingVisitor</span> <span class="k">implements</span> <span class="nx">RoleVisitor</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var Role[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$visited</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitGroup</span><span class="p">(</span><span class="nx">Group</span> <span class="nv">$role</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visited</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$role</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitUser</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$role</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visited</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$role</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return Role[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getVisited</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visited</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Role.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Visitor</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Role</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">RoleVisitor</span> <span class="nv">$visitor</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>User.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Visitor</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">Role</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;User %s&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">RoleVisitor</span> <span class="nv">$visitor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$visitor</span><span class="o">-&gt;</span><span class="na">visitUser</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Group.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Visitor</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Group</span> <span class="k">implements</span> <span class="nx">Role</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Group: %s&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">RoleVisitor</span> <span class="nv">$visitor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$visitor</span><span class="o">-&gt;</span><span class="na">visitGroup</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/VisitorTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\Tests\Visitor\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Visitor\RecordingVisitor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Visitor\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Visitor\Group</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Visitor\Role</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Visitor</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VisitorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">RecordingVisitor</span> <span class="nv">$visitor</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visitor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RecordingVisitor</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">provideRoles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="s1">&#39;Dominik&#39;</span><span class="p">)],</span>
            <span class="p">[</span><span class="k">new</span> <span class="nx">Group</span><span class="p">(</span><span class="s1">&#39;Administrators&#39;</span><span class="p">)],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @dataProvider provideRoles</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testVisitSomeRole</span><span class="p">(</span><span class="nx">Role</span> <span class="nv">$role</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$role</span><span class="o">-&gt;</span><span class="na">accept</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visitor</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$role</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visitor</span><span class="o">-&gt;</span><span class="na">getVisited</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
<span id="document-More/README"></span><div class="section" id="more">
<h3>More<a class="headerlink" href="#more" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-More/ServiceLocator/README"></span><div class="section" id="service-locator">
<h4><a class="reference external" href="http://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator</a><a class="headerlink" href="#service-locator" title="永久链接至标题">¶</a></h4>
<p><strong>THIS IS CONSIDERED TO BE AN ANTI-PATTERN!</strong></p>
<p>Service Locator is considered for some people an anti-pattern. It violates the Dependency Inversion principle.
Service Locator hides class’ dependencies instead of exposing them as you would do using the Dependency Injection. In case of changes of those dependencies you risk to break the functionality of classes which are using them, making your system difficult to maintain.</p>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>To implement a loosely coupled architecture in order to get better
testable, maintainable and extendable code. DI pattern and Service
Locator pattern are an implementation of the Inverse of Control pattern.</p>
</div>
<div class="section" id="usage">
<h5>Usage<a class="headerlink" href="#usage" title="永久链接至标题">¶</a></h5>
<p>With <code class="docutils literal notranslate"><span class="pre">ServiceLocator</span></code> you can register a service for a given
interface. By using the interface you can retrieve the service and use
it in the classes of the application without knowing its implementation.
You can configure and inject the Service Locator object on bootstrap.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt ServiceLocator UML Diagram" class="align-center" src="_images/uml22.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/More/ServiceLocator">GitHub</a></p>
<p>Service.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Service</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>ServiceLocator.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">OutOfRangeException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServiceLocator</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var string[][]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$services</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @var Service[]</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$instantiated</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addInstance</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$class</span><span class="p">,</span> <span class="nx">Service</span> <span class="nv">$service</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$service</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addClass</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$class</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">has</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$interface</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$interface</span><span class="p">])</span> <span class="o">||</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$interface</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$class</span><span class="p">)</span><span class="o">:</span> <span class="nx">Service</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="nv">$args</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">services</span><span class="p">[</span><span class="nv">$class</span><span class="p">];</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$args</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$args</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">OutOfRangeException</span><span class="p">(</span><span class="s1">&#39;Too many arguments given&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$object</span> <span class="nx">instanceof</span> <span class="nx">Service</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Could not register service: is no instance of Service&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instantiated</span><span class="p">[</span><span class="nv">$class</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$object</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$object</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>LogService.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LogService</span> <span class="k">implements</span> <span class="nx">Service</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/ServiceLocatorTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\ServiceLocator\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\More\ServiceLocator\LogService</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\ServiceLocator\ServiceLocator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ServiceLocatorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">ServiceLocator</span> <span class="nv">$serviceLocator</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ServiceLocator</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testHasServices</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">addInstance</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">new</span> <span class="nx">LogService</span><span class="p">());</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">class</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetWillInstantiateLogServiceIfNoInstanceHasBeenCreatedYet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">addClass</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[]);</span>
        <span class="nv">$logger</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">LogService</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-More/Repository/README"></span><div class="section" id="repository">
<h4>Repository<a class="headerlink" href="#repository" title="永久链接至标题">¶</a></h4>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>Mediates between the domain and data mapping layers using a
collection-like interface for accessing domain objects. Repository
encapsulates the set of objects persisted in a data store and the
operations performed over them, providing a more object-oriented view of
the persistence layer. Repository also supports the objective of
achieving a clean separation and one-way dependency between the domain
and data mapping layers.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Doctrine 2 ORM: there is Repository that mediates between Entity and
DBAL and contains methods to retrieve objects</li>
<li>Laravel Framework</li>
</ul>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="Alt Repository UML Diagram" class="align-center" src="_images/uml21.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/More/Repository">GitHub</a></p>
<p>Post.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository\Domain</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Post</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">PostId</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">PostStatus</span> <span class="nv">$status</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$title</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$text</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">draft</span><span class="p">(</span><span class="nx">PostId</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$title</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span><span class="o">:</span> <span class="nx">Post</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">self</span><span class="p">(</span>
            <span class="nv">$id</span><span class="p">,</span>
            <span class="nx">PostStatus</span><span class="o">::</span><span class="na">fromString</span><span class="p">(</span><span class="nx">PostStatus</span><span class="o">::</span><span class="na">STATE_DRAFT</span><span class="p">),</span>
            <span class="nv">$title</span><span class="p">,</span>
            <span class="nv">$text</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">fromState</span><span class="p">(</span><span class="k">array</span> <span class="nv">$state</span><span class="p">)</span><span class="o">:</span> <span class="nx">Post</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">self</span><span class="p">(</span>
            <span class="nx">PostId</span><span class="o">::</span><span class="na">fromInt</span><span class="p">(</span><span class="nv">$state</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]),</span>
            <span class="nx">PostStatus</span><span class="o">::</span><span class="na">fromInt</span><span class="p">(</span><span class="nv">$state</span><span class="p">[</span><span class="s1">&#39;statusId&#39;</span><span class="p">]),</span>
            <span class="nv">$state</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
            <span class="nv">$state</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">PostId</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">PostStatus</span> <span class="nv">$status</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$title</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span> <span class="o">=</span> <span class="nv">$text</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span><span class="o">:</span> <span class="nx">PostId</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getStatus</span><span class="p">()</span><span class="o">:</span> <span class="nx">PostStatus</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getText</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTitle</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PostId.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository\Domain</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This is a perfect example of a value object that is identifiable by it&#39;s value alone and</span>
<span class="sd"> * is guaranteed to be valid each time an instance is created. Another important property of value objects</span>
<span class="sd"> * is immutability.</span>
<span class="sd"> *</span>
<span class="sd"> * Notice also the use of a named constructor (fromInt) which adds a little context when creating an instance.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PostId</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">fromInt</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span><span class="o">:</span> <span class="nx">PostId</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">ensureIsValid</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">self</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toInt</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">ensureIsValid</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid PostId given&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PostStatus.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository\Domain</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Like PostId, this is a value object which holds the value of the current status of a Post. It can be constructed</span>
<span class="sd"> * either from a string or int and is able to validate itself. An instance can then be converted back to int or string.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PostStatus</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">STATE_DRAFT_ID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATE_PUBLISHED_ID</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">STATE_DRAFT</span> <span class="o">=</span> <span class="s1">&#39;draft&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATE_PUBLISHED</span> <span class="o">=</span> <span class="s1">&#39;published&#39;</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">array</span> <span class="nv">$validStates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATE_DRAFT_ID</span> <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">STATE_DRAFT</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATE_PUBLISHED_ID</span> <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">STATE_PUBLISHED</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">fromInt</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$statusId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">ensureIsValidId</span><span class="p">(</span><span class="nv">$statusId</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">self</span><span class="p">(</span><span class="nv">$statusId</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$validStates</span><span class="p">[</span><span class="nv">$statusId</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">fromString</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">ensureIsValidName</span><span class="p">(</span><span class="nv">$status</span><span class="p">);</span>
        <span class="nv">$state</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="nv">$status</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$validStates</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$state</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid state given!&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">self</span><span class="p">(</span><span class="nv">$state</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">toInt</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * there is a reason that I avoid using __toString() as it operates outside of the stack in PHP</span>
<span class="sd">     * and is therefor not able to operate well with exceptions</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">ensureIsValidId</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$status</span><span class="p">,</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$validStates</span><span class="p">),</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid status id given&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">ensureIsValidName</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$status</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$validStates</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s1">&#39;Invalid status name given&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>PostRepository.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">OutOfBoundsException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\Domain\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\Domain\PostId</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This class is situated between Entity layer (class Post) and access object layer (Persistence).</span>
<span class="sd"> *</span>
<span class="sd"> * Repository encapsulates the set of objects persisted in a data store and the operations performed over them</span>
<span class="sd"> * providing a more object-oriented view of the persistence layer</span>
<span class="sd"> *</span>
<span class="sd"> * Repository also supports the objective of achieving a clean separation and one-way dependency</span>
<span class="sd"> * between the domain and data mapping layers</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PostRepository</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Persistence</span> <span class="nv">$persistence</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Persistence</span> <span class="nv">$persistence</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistence</span> <span class="o">=</span> <span class="nv">$persistence</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">generateId</span><span class="p">()</span><span class="o">:</span> <span class="nx">PostId</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">PostId</span><span class="o">::</span><span class="na">fromInt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistence</span><span class="o">-&gt;</span><span class="na">generateId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">findById</span><span class="p">(</span><span class="nx">PostId</span> <span class="nv">$id</span><span class="p">)</span><span class="o">:</span> <span class="nx">Post</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$arrayData</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistence</span><span class="o">-&gt;</span><span class="na">retrieve</span><span class="p">(</span><span class="nv">$id</span><span class="o">-&gt;</span><span class="na">toInt</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">OutOfBoundsException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">OutOfBoundsException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Post with id %d does not exist&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="o">-&gt;</span><span class="na">toInt</span><span class="p">()),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$e</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Post</span><span class="o">::</span><span class="na">fromState</span><span class="p">(</span><span class="nv">$arrayData</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">persistence</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">([</span>
            <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toInt</span><span class="p">(),</span>
            <span class="s1">&#39;statusId&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getStatus</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toInt</span><span class="p">(),</span>
            <span class="s1">&#39;text&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getText</span><span class="p">(),</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Persistence.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">Persistence</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">generateId</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">persist</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieve</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>InMemoryPersistence.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">OutOfBoundsException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InMemoryPersistence</span> <span class="k">implements</span> <span class="nx">Persistence</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">array</span> <span class="nv">$data</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$lastId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">generateId</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastId</span><span class="o">++</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">persist</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lastId</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieve</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">OutOfBoundsException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;No data found for ID %d&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$id</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$id</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">OutOfBoundsException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;No data found for ID %d&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$id</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/PostRepositoryTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\Repository\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">OutOfBoundsException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\Domain\PostId</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\Domain\PostStatus</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\InMemoryPersistence</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\Domain\Post</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\Repository\PostRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostRepositoryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">PostRepository</span> <span class="nv">$repository</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PostRepository</span><span class="p">(</span><span class="k">new</span> <span class="nx">InMemoryPersistence</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanGenerateId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span><span class="o">-&gt;</span><span class="na">generateId</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toInt</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowsExceptionWhenTryingToFindPostWhichDoesNotExist</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">OutOfBoundsException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectExceptionMessage</span><span class="p">(</span><span class="s1">&#39;Post with id 42 does not exist&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span><span class="o">-&gt;</span><span class="na">findById</span><span class="p">(</span><span class="nx">PostId</span><span class="o">::</span><span class="na">fromInt</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanPersistPostDraft</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$postId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span><span class="o">-&gt;</span><span class="na">generateId</span><span class="p">();</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">draft</span><span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="s1">&#39;Repository Pattern&#39;</span><span class="p">,</span> <span class="s1">&#39;Design Patterns PHP&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span><span class="o">-&gt;</span><span class="na">findById</span><span class="p">(</span><span class="nv">$postId</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$postId</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">repository</span><span class="o">-&gt;</span><span class="na">findById</span><span class="p">(</span><span class="nv">$postId</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nx">PostStatus</span><span class="o">::</span><span class="na">STATE_DRAFT</span><span class="p">,</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getStatus</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<span id="document-More/EAV/README"></span><div class="section" id="entity-attribute-value-eav">
<h4><a class="reference external" href="https://en.wikipedia.org/wiki/Entity–attribute–value_model">Entity-Attribute-Value (EAV)</a><a class="headerlink" href="#entity-attribute-value-eav" title="永久链接至标题">¶</a></h4>
<p>The Entity–attribute–value (EAV) pattern in order to implement EAV model with PHP.</p>
<div class="section" id="purpose">
<h5>Purpose<a class="headerlink" href="#purpose" title="永久链接至标题">¶</a></h5>
<p>The Entity–attribute–value (EAV) model is a data model to describe entities
where the number of attributes (properties, parameters) that can be used
to describe them is potentially vast, but the number that will actually apply
to a given entity is relatively modest.</p>
</div>
<div class="section" id="uml-diagram">
<h5>UML Diagram<a class="headerlink" href="#uml-diagram" title="永久链接至标题">¶</a></h5>
<img alt="EAV UML Diagram" class="align-center" src="_images/uml20.png" />
</div>
<div class="section" id="code">
<h5>Code<a class="headerlink" href="#code" title="永久链接至标题">¶</a></h5>
<p>You can also find this code on <a class="reference external" href="https://github.com/domnikl/DesignPatternsPHP/tree/master/More/EAV">GitHub</a></p>
<p>Entity.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\EAV</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">SplObjectStorage</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Entity</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var SplObjectStorage&lt;Value,Value&gt;</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$values</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string $name</span>
<span class="sd">     * @param Value[] $values</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var SplObjectStorage&lt;Value,Value&gt; values */</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplObjectStorage</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$values</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$text</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">];</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$value</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Attribute.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\EAV</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">SplObjectStorage</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Attribute</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">SplObjectStorage</span> <span class="nv">$values</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplObjectStorage</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addValue</span><span class="p">(</span><span class="nx">Value</span> <span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getValues</span><span class="p">()</span><span class="o">:</span> <span class="nx">SplObjectStorage</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Value.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\EAV</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Value</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nx">Attribute</span> <span class="nv">$attribute</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Attribute</span> <span class="nv">$attribute</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attribute</span> <span class="o">=</span> <span class="nv">$attribute</span><span class="p">;</span>

        <span class="nv">$attribute</span><span class="o">-&gt;</span><span class="na">addValue</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%s: %s&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attribute</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h5>
<p>Tests/EAVTest.php</p>
<div class="highlight-php notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">DesignPatterns\More\EAV\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DesignPatterns\More\EAV\Attribute</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\EAV\Entity</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">DesignPatterns\More\EAV\Value</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EAVTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCanAddAttributeToEntity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$colorAttribute</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Attribute</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">);</span>
        <span class="nv">$colorSilver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Value</span><span class="p">(</span><span class="nv">$colorAttribute</span><span class="p">,</span> <span class="s1">&#39;silver&#39;</span><span class="p">);</span>
        <span class="nv">$colorBlack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Value</span><span class="p">(</span><span class="nv">$colorAttribute</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">);</span>

        <span class="nv">$memoryAttribute</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Attribute</span><span class="p">(</span><span class="s1">&#39;memory&#39;</span><span class="p">);</span>
        <span class="nv">$memory8Gb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Value</span><span class="p">(</span><span class="nv">$memoryAttribute</span><span class="p">,</span> <span class="s1">&#39;8GB&#39;</span><span class="p">);</span>

        <span class="nv">$entity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Entity</span><span class="p">(</span><span class="s1">&#39;MacBook Pro&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$colorSilver</span><span class="p">,</span> <span class="nv">$colorBlack</span><span class="p">,</span> <span class="nv">$memory8Gb</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;MacBook Pro, color: silver, color: black, memory: 8GB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$entity</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2011-2019, Dominik Liebler and contributors
      
        <span class="commit">
          Revision <code>d0ba13b6</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/zh_CN/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/designpatternsphp-zh-cn/downloads/htmlzip/latest/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/designpatternsphp-zh-cn/?fromdocs=designpatternsphp-zh-cn">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/designpatternsphp-zh-cn/?fromdocs=designpatternsphp-zh-cn">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>